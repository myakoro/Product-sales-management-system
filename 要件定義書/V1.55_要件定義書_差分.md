# Rinori 売上管理システム V1.55 要件定義 差分案

## 1. 概要
V1.54で実装したNext Engine API連携機能を基盤として、以下の分析機能強化を行う:
1. **商品カテゴリー機能**: 商品をカテゴリー別に分類し、カテゴリー単位でのPL分析を可能にする
2. **PL分析のUX改善**: 期間指定のデフォルト値を先月に設定し、操作性を向上

> [!NOTE]
> **グラフ表示機能はV1.56で実装**  
> 月次推移を視覚的に把握できるグラフ機能は、V1.56で実装予定です。V1.55でカテゴリー機能の基盤を整備し、V1.56でカテゴリー別グラフを含む可視化機能を追加します。

## 2. 機能要件

### 2-1. 商品カテゴリー管理機能

#### 2-1-1. カテゴリーマスタ
- **カテゴリーの作成・編集・削除**: 
  - ユーザーが任意のカテゴリー名を設定できること（例: 「フリーズドライ」「調味料」「季節商品」等）
  - カテゴリーの表示順序を設定できること
  - カテゴリーの有効/無効を切り替えられること
- **権限制御**: カテゴリーマスタの編集は管理者（マスター権限）のみが実行可能とする

#### 2-1-2. 商品のカテゴリー紐付け
- **一括設定方式**: 
  - カテゴリー編集画面で、そのカテゴリーに所属する商品を**複数選択**して一括登録できること
  - チェックボックスまたは選択リストで、既存の商品マスタから複数商品を選択可能とする
  - **禁止事項**: 商品マスタ登録画面で1つ1つ編集ボタンを押して個別に設定する方式は採用しない
- **カテゴリー未設定の許容**: 
  - すべての商品が必ずカテゴリーに属する必要はない（未分類商品の存在を許容）
- **1商品1カテゴリー**: 
  - 1つの商品は1つのカテゴリーにのみ所属する（複数カテゴリーへの同時所属は不可）

#### 2-1-3. カテゴリー別PL分析
- **表示対象**: 
  - 既存のPL分析画面（月次・期間）に、「カテゴリー別」の表示オプションを追加
  - カテゴリーごとの売上高、売上原価、粗利、粗利率を集計・表示
- **集計ロジック**: 
  - カテゴリーに紐付いた商品の売上実績を合算
  - カテゴリー未設定の商品は「未分類」として別途集計
- **表示形式**: 
  - カテゴリー名、売上高、粗利、粗利率を一覧表示
  - 既存の商品別PL分析と同様のレイアウト・操作性を維持
  - **ソート機能**: 各カラム（売上高、粗利、粗利率）でソート可能
    - デフォルト: 売上高降順
    - カラムヘッダーをクリックすると昇順/降順を切り替え

### 2-2. PL分析 期間デフォルト値の変更

#### 2-2-1. デフォルト期間の設定
- **対象画面**: PL分析（月次・期間）画面
- **現状**: デフォルト値が未設定または当月
- **変更内容**: 
  - 画面を開いた際の期間デフォルト値を**「先月（前月）」**に設定
  - 例: 2026年1月に画面を開いた場合、自動的に「2025年12月」が選択された状態で表示
- **ユーザー操作**: 
  - デフォルト値は変更可能（ユーザーが任意の期間を選択できる）

## 3. 非機能要件

### 3-1. ユーザビリティ
- **直感的な操作**: 
  - カテゴリー設定は、チェックボックスで簡単に操作可能
  - カテゴリー別PL表示は、既存のPL分析と同様の操作性を維持

### 3-2. データ整合性
- **カテゴリー削除時の挙動**: 
  - カテゴリーを削除した場合、紐付いていた商品は「未分類」に自動移行
  - 過去の売上実績データには影響を与えない（履歴は保持）

## 4. UI/UX要件

### 4-1. カテゴリー管理画面
- **画面構成**: 
  - 左側: カテゴリー一覧（作成・編集・削除ボタン）
  - 右側: 選択中のカテゴリーに所属する商品一覧
  - 下部: 未所属商品一覧（チェックボックスで選択 → 「追加」ボタンで一括登録）
- **操作フロー**: 
  1. カテゴリーを選択または新規作成
  2. 未所属商品一覧から該当商品を複数選択
  3. 「カテゴリーに追加」ボタンで一括登録
  4. 所属商品一覧から削除も可能（チェックボックス + 「削除」ボタン）

### 4-2. PL分析画面の拡張
- **タブ構成（案）**: 
  - タブ1: 全体PL（既存）
  - タブ2: 商品別PL（既存）
  - タブ3: **カテゴリー別PL**（新規）
- **期間選択UI**: 
  - 月次・期間選択のドロップダウンで、デフォルト値として先月が選択済み
  - プレースホルダーに「先月がデフォルトです」等のヒント表示（オプション）

## 5. 実装優先順位

### Phase 1（最優先）
1. **商品カテゴリー管理機能**
   - カテゴリーマスタのCRUD
   - 商品の一括紐付けUI
   - カテゴリー別PL集計・表示

### Phase 2（高優先）
2. **PL分析 期間デフォルト値の変更**
   - 先月をデフォルト値に設定

## 6. 運用上の考慮事項

### 6-1. カテゴリー設計のガイドライン
- **推奨カテゴリー例**: 
  - 商品タイプ別（フリーズドライ、調味料、ギフトセット等）
  - 季節別（春夏商品、秋冬商品、通年商品）
  - 販売チャネル別（EC専用、卸売専用、共通商品）
- **カテゴリー数の推奨**: 
  - 5〜15カテゴリー程度（多すぎると分析が煩雑化）

### 6-2. データ移行
- **既存商品の扱い**: 
  - V1.55リリース時点で既存の商品は「未分類」として扱う
  - ユーザーが段階的にカテゴリー設定を行う運用を想定

## 7. 成功基準

### 7-1. 機能面
- [ ] カテゴリーを作成し、複数商品を一括で紐付けできる
- [ ] カテゴリー別PLで、正しく集計された売上・粗利が表示される
- [ ] PL分析画面を開くと、自動的に先月が選択されている
- [ ] カテゴリー別PLで各カラムをクリックしてソートできる

### 7-2. UX面
- [ ] カテゴリー設定が5分以内に完了できる（10商品を2カテゴリーに分類）
- [ ] 既存のPL分析機能との操作性が統一されている

## 8. V1.56への引き継ぎ事項

> [!IMPORTANT]
> **グラフ表示機能はV1.56で実装**  
> V1.55で実装したカテゴリー機能を基盤として、V1.56では以下のグラフ機能を実装予定:
> - 商品予算 vs 商品実績 (SC-11) のグラフ（商品別/カテゴリー別）
> - PL分析 (月次・期間) のグラフ（全体PL/商品別PL/カテゴリー別PL）
> 
> 詳細は「V1.56_要件定義書_差分.md」を参照してください。

---

**作成日**: 2026-01-07  
**対象バージョン**: V1.55  
**前提バージョン**: V1.54（Next Engine API連携完了）
