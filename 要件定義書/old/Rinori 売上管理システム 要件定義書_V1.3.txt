Rinori 販売管理システム

要件定義書_V1.3（完全版）**

変更履歴：
- V1.0: 初版
- V1.1: ユーザー権限追加、SKU変換ルール変更、画面削除
- V1.2: SC-10期間予算編集画面を全商品一覧入力方式に変更
- V1.3: ユーザビリティ改善（SC-09とSC-10統合、SC-14とSC-15統合、SC-03一括選択追加）

1. プロジェクト概要

本システムは、小規模D2Cブランド Rinori（リノリ） の販売実績・予算・PL（損益）を
商品単位・月単位・期間単位で可視化するための社内向けWebアプリケーションである。

NE（ネクストエンジン）出力データを基礎に、
商品マスタ・売上実績・広告費・予算 を一元管理する。

経営判断を支えるため、

商品別売上・粗利

予算 vs 実績

月次PL

期間PL
を瞬時に確認できる仕組みを提供する。

将来的に、Rinori以外のブランド向けに 改修・横展開可能な設計を前提 とする。

ブラウザは Google Chrome（PC）限定。

2. 目的 / 達成する価値
2-1. 経営判断の迅速化

商品（型番）別の数量・売上・原価・粗利の可視化

予算 vs 実績（数量・売上）の進捗をシンプルに把握

月次PL（売上−原価−広告費＝利益） の即時算出

任意期間（3ヶ月・6ヶ月・期首〜現在・手動範囲）の集計

2-2. 運用効率化

NE売上CSVをアップロードするだけで 実績入力が完了 する

商品一覧CSV/売上CSVからの商品マスタ差分登録を自動化

商品マスタの原価未設定などを自動検知し、ミスを回避

イベント売上などの手入力実績も柔軟に追加できる

3. 利用ユーザー／権限
3-1. ユーザー権限
● マスター権限（オーナー）

すべての画面・設定・機能にアクセス可能。

● スタッフ権限（スタッフ）

広告費入力

例外実績入力（手入力実績）

商品別の実績・予算 vs 実績・PL閲覧

🔴 スタッフには 非公開の機能

月次PL・期間PLの「総合計」

総売上

総原価

総粗利

総広告費

総利益

各率（原価率・粗利率・広告率・利益率）

※ 各商品別の実績・PLは閲覧OK。

3-2. ユーザー管理機能（パスワード変更・ユーザー管理）

本システムは社内利用を前提としているが、運用フェーズでのセキュリティと権限管理を強化するため、
以下のユーザー管理機能を提供する。

● 自分のパスワード変更機能（全ユーザー共通）

- 対象: ログイン済みの全ユーザー（マスター権限・スタッフ権限）
- 目的: 個々のユーザーが自分のパスワードを安全に変更できるようにする。
- 入力項目:
  - 現在のパスワード
  - 新しいパスワード
  - 新しいパスワード（確認用）
- 仕様:
  - 現在のパスワードが正しくない場合はエラーとし、変更を行わない。
  - 新しいパスワードと確認用パスワードが一致しない場合はエラーとする。
  - パスワードはハッシュ化して保存し、平文では保持しない（詳細は仕様書 第5部 セキュリティ考慮事項を参照）。
  - パスワード変更後は、再ログインを要求してもよい（実装側判断）。

● ユーザー管理機能（マスター権限のみ）

- 対象: マスター権限ユーザーのみ。
- 目的: ユーザーアカウント（ユーザー名・権限・パスワード初期化）を、オーナーが一元管理できるようにする。
- 機能概要:
  - ユーザー一覧表示
    - 表示項目: ユーザー名、権限種別（マスター / スタッフ）、作成日時
    - スタッフ権限ユーザーにはこの画面自体を表示しない。
  - ユーザー新規作成
    - 入力: ユーザー名、権限種別、初期パスワード
    - 作成されたユーザーには、初期パスワードを別途安全な経路で共有する前提とする。
  - 権限変更
    - 既存ユーザーの権限（マスター / スタッフ）を変更できる。
    - システムには常に少なくとも1名以上のマスター権限ユーザーが存在するように制御する（最後のマスターをスタッフに変更・削除できない等）。
  - パスワードリセット
    - 選択したユーザーのパスワードを新しい一時パスワードにリセットし、その値を画面に表示する。
    - リセットされた一時パスワードは次回ログイン時に変更を促す運用としてもよい（実装側判断）。

4. SKU → 親コード変換ルール（必須要件）

NE売上CSV・商品一覧CSVの商品コードを、
本システムで管理する「親コード（型番）」に変換する。

● Rule1：RINO- 形式

r"^(RINO-[A-Z0-9]+)"
例：RINO-FR010-X-BLK → RINO-FR010

● Rule2：RINO 形式（ハイフン無し）

r"^(RINO[A-Z]+[0-9]{3,4})"
例：RINODO002BLK → RINODO002

● Rule3：上記以外

元SKUをそのまま親コードとして採用
（仕入商品など）

● ルールの適用順

1 → 2 → 3 の順で評価し、最初に一致したものを採用。

5. CSV取込仕様
5-1. 売上CSV（NE）取込
● アップロード前に必須選択

対象年月（YYYY-MM）

取込モード：

追加モード（差分追加・累積）

上書きモード（その月の実績を全削除して入れ直す）

コメント（任意）

● CSV列の対応

SKU → 親コードへ変換

数量 → NEの「受注数」

売上金額（税込） → 税率設定に基づき 税抜換算（HALF UP）

原価 → 商品マスタから自動取得

粗利 → 売上税別 − 原価（自動）

● 注意点

売上日（日付列）が無いため
→ 実績は対象年月単位で管理
→ 日次集計は将来拡張
→ DBには sales_date カラムだけ確保しておく（NULL運用）

● 実績の即時反映

取込完了後：

月次PL

商品PL

予算 vs 実績
などすべての集計が 即時更新 される。

5-2. 商品一覧CSV取込（マスタ整備）

SKU → 親コード変換

マスタ未登録 → 新規候補

マスタと差異 → 更新候補

原価（税別）＝ CSV左から3列目

定価（税別）＝ CSVの販売価格

ユーザーが選択した行のみ、
商品マスタに登録・更新される。

在庫数などは無視してよい。

5-3. 売上CSVからの新商品検知

売上CSV内に存在するが、商品マスタに無い親コードは「新商品候補」へ

ユーザーは候補を確認し：

「管理中で登録する」

「管理外として扱う（集計対象外）」
を選べる。

毎回ポップアップではなく、
候補一覧画面でまとめて管理 する。

6. 商品マスタ仕様
● 項目

親コード（PK）

商品名

販売価格（税別）

原価（税別）

自社 / 仕入フラグ

管理ステータス（管理中 / 管理外）

商品カテゴリ（NULL許可）【将来拡張用】

登録日・更新日

● 商品カテゴリについて【将来拡張用】

現時点ではUIに表示せず、DB設計のみ準備。

将来的に商品を分類する際に使用（例: トップス、ボトムス、ワンピースなど）。

カテゴリマスタテーブルで管理し、商品マスタから参照。

NULL許可（カテゴリ未設定でも運用可能）。

● 挙動

管理外の商品：

売上CSVに存在しても集計に含めない

予算設定画面にも出さない

ソート：全項目で可能

フィルタ：自社 / 仕入、管理中 / 管理外

検索：商品名・親コードの部分一致

● 警告機能

管理中商品のうち、
「原価・販売価格など必須項目」が未設定のものがあれば：

トップページに警告

不完全マスタ一覧へのリンク
を表示する。

7. 税率設定

初期値：10%

追加形式：「何年何月から何％」を登録

対象年月の税抜換算は、その月に有効な税率を使用

8. 予算管理（最重要領域）
8-1. 月別予算（商品×月）
● 各月ごとに：

予算数量（入力）

予算売上（販売価格×数量、自動計算／編集可）

予算原価（原価×数量、自動）

予算粗利（売上−原価、自動）

「管理中」の商品のみ表示。

8-2. 期間予算（全商品一覧で入力）【V1.2変更】

● 画面構成

期間設定エリア：
  開始年月・終了年月を選択
  「表示」ボタンで管理中の全商品を一覧表示

期間合計サマリ（画面上部）：
  全商品の合計売上・合計粗利をリアルタイム表示
  入力と同時に自動更新

商品別期間予算テーブル：
  縦方向：管理中の全商品
  横方向：期間合計（左側、固定）+ 月別数量（右側、スクロール）

● テーブル列構成（左から順に）

1. 商品コード（固定列）
2. 商品名（固定列）
3. 期間合計数量（入力欄、固定列）← ここに入力
4. 期間売上（税別）（自動計算、固定列）
5. 期間粗利（自動計算、固定列）
6. 01月（自動配分、スクロール）
7. 02月（自動配分、スクロール）
8. ... 期間内の全ての月

● リアルタイム自動計算

入力時の動作：
1. 期間合計数量を入力（例：60）
2. → 即座に期間売上・粗利を計算
   期間売上 = 期間合計数量 × 販売価格（税別）
   期間粗利 = 期間合計数量 × (販売価格 - 原価)
3. → 月別数量を自動配分（等分、端数は最終月に寄せる）
4. → 画面上部のサマリ（全商品の合計）も更新

月別数量を手動変更した場合：
1. 月別数量を変更（例：01月を50に変更）
2. → 期間合計数量を自動再計算（全月の合計）
3. → 期間売上・粗利を再計算
4. → 画面上部のサマリも更新

※ 常に期間合計と月別合計が一致するExcel型UI

● 月別数量の自動配分

期間内の月数に応じて 数量を等分割
（端数は最終月に寄せる）

例：期間 2025-01〜06（6ヶ月）、期間合計数量 60個
→ 01月:10, 02月:10, 03月:10, 04月:10, 05月:10, 06月:10

例：期間 2025-01〜03（3ヶ月）、期間合計数量 100個
→ 01月:33, 02月:33, 03月:34（余り1を最終月に加算）

● 月別数量の手動調整

自動配分後、必要に応じて月別数量を手動で調整可能。
調整後は期間合計とのズレを警告表示。

● 期間合計 vs 合計ズレ警告

画面上部で：
  期間合計数量（入力値）
  現在の月別合計数量
  ズレ量（+3 / −2など）
をリアルタイム表示。

ズレた状態で保存する場合は警告表示。

8-3. 期間予算の保持

期間予算そのものを履歴として保存し、
後から「なぜこの数字になったのか」を確認できる。

9. 予算 vs 実績（進捗管理）

単月／複数月／任意期間を指定可能

商品別に：

予算数量

実績数量

数量達成率

予算売上（税別）

実績売上（税別）

売上達成率

すべてリアルタイム更新。

10. PL（損益計算）
10-1. 月次PL

表示項目：

売上（税別）

原価（税別）

粗利

広告費

営業利益（粗利−広告費）

● 率（％）を必ず併記

原価率

粗利率

広告率

利益率

※ スタッフ権限では非表示。

10-2. 期間PL（任意範囲）【V1.3改善】

● 期間選択方式（ラジオボタンで選択）

方式1：プリセット期間
  - 単月
  - 3ヶ月
  - 6ヶ月
  - 期首〜現在

方式2：任意の期間
  - 開始年月（YYYY-MM）
  - 終了年月（YYYY-MM）

● UI動作

ラジオボタンで選択した方式のみが有効

非選択の方式はグレーアウト（disabled）

「表示」ボタンで選択中の方式で期間を決定

● 表示内容は月次PLと同じ

10-3. 商品別PL

商品ごとに：

売上（税別）

原価（税別）

粗利

原価率（％）

粗利率（％）

商品別には広告費配賦しない（将来拡張）。

11. 広告費管理【V1.3改善】

● 画面構成（タブ方式）

タブ1：広告費一覧
  - 既存の広告費を一覧表示
  - インライン編集（行をクリックして直接編集）
  - 最下行に新規追加行を常に表示
  - 削除ボタン

タブ2：カテゴリ管理【V1.3新規追加】
  - カテゴリ一覧テーブル
  - カテゴリ名の編集（インライン）
  - 新規カテゴリ追加
  - 削除ボタン

● 広告費の項目

日付（YYYY-MM-DD）

金額

カテゴリ（ドロップダウン選択）

メモ

● カテゴリマスタ

カテゴリ名（例：META広告、Google広告、展示会費、アンバサダー）

作成日・更新日

カテゴリ管理タブで追加・編集・削除が可能

12. 取込履歴管理

売上CSV・商品一覧CSV・広告費CSV すべてに対し履歴を保存：

取込種別

対象年月

モード（追加／上書き）

コメント

取込日時

件数

13. 画面一覧（UI構成はWindsurfへ委譲）

トップページ（ダッシュボード）

売上CSV取込画面

商品一覧CSV取込画面

新商品候補一覧

商品マスタ一覧・編集

期間予算編集画面（商品別）

月別予算画面

予算 vs 実績画面

月次／期間PL画面

商品別PL画面

広告費一覧／入力画面

税率設定画面

取込履歴画面

コード変換チェック画面

14. 非機能（軽め / 個人開発に最適化）

ブラウザ：PC版Chromeのみサポート

同時アクセスは想定3名以内

データ容量はCSV月次運用に耐えれば十分

バックアップ/ログは設計側に委譲（最低限の履歴保持あれば可）

15. 将来拡張（設計で潰さない範囲で）

マルチブランド化

API連携（広告費）

日次PL

商品別広告費配賦

期間予算の自動配分アルゴリズム（重み・季節係数）