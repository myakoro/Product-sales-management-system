# Rinori 売上管理システム V1.4 テスト計画書

**作成日**: 2024年12月12日  
**テスト担当**: アンチグラビティ  
**対象バージョン**: V1.4

---

## 1. テスト概要

V1.4で追加・改修された機能について、正常系・異常系のテストを実施する。

### 1.1 V1.4 主要変更点

1. **販路（Sales Channel）機能の追加**
   - 販路マスタ（EC, モール, 卸, 催事ポップアップ, その他）
   - 売上CSV取込時に販路選択必須
   - 上書きモードは同月・同販路のみ削除

2. **PL画面の販路フィルタ対応**
   - 全体PL・商品別PLで販路フィルタ追加
   - 販路別表示時は広告費・営業利益を非表示（粗利まで）

3. **予算vs実績画面の改善**
   - 予算・実績がどちらも0の商品を非表示にするトグル追加

4. **取込履歴画面の新設**
   - 履歴一覧表示
   - 販路変更機能
   - 履歴削除機能（紐づく売上データも削除）

---

## 2. テスト環境

| 項目 | 内容 |
|------|------|
| URL | http://localhost:3000 |
| ブラウザ | Chrome最新版 |
| テストユーザー | admin / admin123 |

### 2.1 事前準備

1. `npm run dev` でサーバー起動
2. adminユーザーでログイン
3. 販路マスタが存在することを確認（設定画面または直接DB確認）

---

## 3. テストケース

### 3.1 売上CSV取込画面（/sales）

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| 1-1 | 販路セレクト表示確認 | 画面を開く | 販路セレクトボックスが表示され、5つの販路が選択可能 | | |
| 1-2 | 販路未選択でCSV取込 | 販路を選択せずに「取り込む」ボタン押下 | エラーメッセージ「販路を選択してください」が表示される | | |
| 1-3 | 販路選択してCSV取込（追加モード） | 販路「EC」を選択、CSVファイル選択、追加モードで取込 | 正常に取込完了、件数が表示される | | |
| 1-4 | 販路選択してCSV取込（上書きモード） | 同月・同販路「EC」で上書きモード取込 | 確認ダイアログに「同一販路」の文言あり、既存データが削除され新データで置換 | | |
| 1-5 | 異なる販路で上書きモード | 同月・異なる販路「モール」で上書きモード取込 | 「EC」のデータは残り、「モール」のデータのみ上書き | | |

### 3.2 全体PL画面（/pl）

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| 2-1 | 販路セレクト表示確認 | 画面を開く | 販路セレクトボックスが表示され、「全販路」+5つの販路が選択可能 | | |
| 2-2 | 全販路でPL表示 | 「全販路」選択、期間指定して「表示」 | 売上・原価・粗利・広告費・営業利益がすべて表示される | | |
| 2-3 | 特定販路でPL表示 | 「EC」選択、期間指定して「表示」 | 売上・原価・粗利のみ表示、広告費・営業利益は非表示 | | |
| 2-4 | 販路別注意書き表示 | 特定販路を選択 | 「※販路別では広告費・営業利益は表示されません」のメッセージ表示 | | |
| 2-5 | 販路切替時の表示変化 | 全販路→EC→全販路と切り替え | 広告費・営業利益の表示/非表示が正しく切り替わる | | |

### 3.3 商品別PL画面（/pl/products）

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| 3-1 | 販路セレクト表示確認 | 画面を開く | 販路セレクトボックスが表示される | | |
| 3-2 | 全販路で商品別PL表示 | 「全販路」選択、期間指定して「表示」 | 全販路の売上を合算した商品別PLが表示される | | |
| 3-3 | 特定販路で商品別PL表示 | 「EC」選択、期間指定して「表示」 | EC販路のみの商品別PLが表示される | | |
| 3-4 | 販路別の数値確認 | 複数販路にデータがある商品で確認 | 販路別の数値が正しくフィルタされている | | |

### 3.4 予算vs実績画面（/budget/vs-actual）

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| 4-1 | 0行非表示トグル表示確認 | 画面を開き、期間指定して「表示」 | 「予算・実績がどちらも0の商品を非表示」チェックボックスが表示される | | |
| 4-2 | 0行非表示ON（デフォルト） | チェックON状態で表示 | 予算・実績がどちらも0の商品は一覧に表示されない | | |
| 4-3 | 0行非表示OFF | チェックをOFFにする | 予算・実績が0の商品も一覧に表示される | | |
| 4-4 | 件数表示の確認 | トグルON/OFF切替 | 件数表示がフィルタ後の件数に変化する | | |

### 3.5 取込履歴画面（/import-histories）

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| 5-1 | 画面表示確認 | /import-histories にアクセス | 取込履歴一覧が表示される | | |
| 5-2 | 履歴一覧の項目確認 | 一覧を確認 | 取込日時、種別、対象年月、モード、販路、コメント、件数、実行者が表示される | | |
| 5-3 | 販路フィルタ | 販路「EC」を選択して「検索」 | EC販路の履歴のみ表示される | | |
| 5-4 | 期間フィルタ | 対象年月の範囲を指定して「検索」 | 指定期間の履歴のみ表示される | | |
| 5-5 | 販路変更機能 | 「販路変更」ボタン押下、新しい販路を選択して「保存」 | 履歴の販路が変更され、紐づく売上データの販路も変更される | | |
| 5-6 | 販路変更後のPL確認 | 販路変更後、PL画面で確認 | 変更後の販路でPLに反映されている | | |
| 5-7 | 履歴削除機能 | 「削除」ボタン押下、確認ダイアログで「はい、削除する」 | 履歴と紐づく売上データが削除される | | |
| 5-8 | 削除後のPL確認 | 削除後、PL画面で確認 | 削除した履歴の売上がPLから除外されている | | |
| 5-9 | 削除キャンセル | 「削除」ボタン押下、確認ダイアログで「いいえ」 | 削除されない | | |

---

## 4. 回帰テスト

既存機能が正常に動作することを確認する。

| No | テスト項目 | 手順 | 期待結果 | 結果 | 備考 |
|----|-----------|------|----------|------|------|
| R-1 | ログイン | admin/admin123でログイン | 正常にログインできる | | |
| R-2 | ダッシュボード表示 | ログイン後のダッシュボード確認 | 正常に表示される | | |
| R-3 | 商品マスタ一覧 | /products にアクセス | 商品一覧が表示される | | |
| R-4 | 商品登録 | 新規商品を登録 | 正常に登録できる | | |
| R-5 | 予算登録 | /budget で予算を登録 | 正常に登録できる | | |
| R-6 | 広告費登録 | /ad-expenses で広告費を登録 | 正常に登録できる | | |
| R-7 | 税率設定 | /settings/tax-rates で税率確認 | 正常に表示・編集できる | | |

---

## 5. テストデータ

### 5.1 テスト用CSVファイル

以下の形式のCSVファイルを用意してテストに使用する。

```csv
商品コード,商品名,受注日,受注数,小計
RINO-FR001,テスト商品A,2024-12-01,10,50000
RINO-FR002,テスト商品B,2024-12-02,5,25000
```

### 5.2 テストシナリオ

1. **シナリオA**: EC販路で12月分を追加取込
2. **シナリオB**: モール販路で12月分を追加取込
3. **シナリオC**: EC販路で12月分を上書き取込（シナリオAのデータが置換される）
4. **シナリオD**: PL画面で全販路/EC/モールそれぞれ確認
5. **シナリオE**: 取込履歴から販路変更
6. **シナリオF**: 取込履歴から削除

---

## 6. 不具合報告フォーマット

不具合発見時は以下の形式で報告してください。

```
【不具合番号】BUG-001
【発見日】2024/12/12
【画面】売上CSV取込画面
【テストケースNo】1-3
【現象】（実際に起きた現象を記載）
【期待動作】（本来の期待動作を記載）
【再現手順】
1. 
2. 
3. 
【スクリーンショット】（あれば添付）
【備考】
```

---

## 7. テスト完了基準

- 全テストケースが実施完了
- 重大な不具合（機能が使用不可）がないこと
- 中程度の不具合は対応方針が決定していること

---

## 8. 承認

| 役割 | 氏名 | 日付 | 署名 |
|------|------|------|------|
| テスト実施者 | | | |
| テスト承認者 | | | |
