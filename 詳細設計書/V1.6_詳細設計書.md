# Rinori è²©å£²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  è©³ç´°è¨­è¨ˆæ›¸ V1.6ï¼ˆçµ±åˆç‰ˆï¼‰

## å¤‰æ›´å±¥æ­´
- V1.4: è²©è·¯ãƒã‚¹ã‚¿ã€è²©è·¯åˆ¥PLã€å–è¾¼å±¥æ­´æ‹¡å¼µã€äºˆç®—vså®Ÿç¸¾0è¡Œãƒ•ã‚£ãƒ«ã‚¿
- V1.4.5: CSVæ§˜å¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€åºƒå‘Šè²»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†æ§‹æˆã€ã‚¿ãƒ–çµ±åˆã€seed.jsåæ˜ 
- V1.5: CSVãƒ‘ãƒ¼ã‚¹å …ç‰¢åŒ–ï¼ˆUTF-8/Shift-JISè‡ªå‹•åˆ¤åˆ¥ã€ä¸æ­£ã‚¯ã‚©ãƒ¼ãƒˆè£œæ­£ã€ç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿è­·ï¼‰
- V1.51: Amazon CSVå–è¾¼å¯¾å¿œï¼ˆASINç…§åˆãƒ»ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠï¼‰
- V1.52: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ï¼ˆé™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€æœŸé–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ¼ãƒˆé †æ”¹å–„ç­‰ï¼‰
- V1.53: åºƒå‘Šè²»äºˆç®—ç®¡ç†ï¼ˆAdBudgetãƒ†ãƒ¼ãƒ–ãƒ«ã€PLäºˆå®Ÿæ¯”è¼ƒï¼‰
- V1.54: ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³APIé€£æºï¼ˆOAuthèªè¨¼ã€å£²ä¸Šãƒ‡ãƒ¼ã‚¿åŒæœŸï¼‰
- V1.55: å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼æ©Ÿèƒ½ï¼ˆProductCategoryãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥PLåˆ†æï¼‰
- V1.56: ã‚°ãƒ©ãƒ•å¯è¦–åŒ–æ©Ÿèƒ½ï¼ˆRechartsã€äºˆç®—vså®Ÿç¸¾ã‚°ãƒ©ãƒ•ã€PLæ¨ç§»ã‚°ãƒ©ãƒ•ã€å•†å“ãƒã‚¹ã‚¿CSVå‡ºåŠ›ï¼‰
- V1.565: ã‚°ãƒ©ãƒ•è¤‡æ•°æ¯”è¼ƒæ©Ÿèƒ½ï¼ˆæœ€å¤§5ä»¶æ¯”è¼ƒã€å…¨åˆ†æç”»é¢ã¸ã®ã‚°ãƒ©ãƒ•é…ç½®ï¼‰
- V1.57: åˆ†æå¼·åŒ–ï¼ˆNEéå»ãƒ‡ãƒ¼ã‚¿åŒæœŸã€æ§‹æˆæ¯”è¡¨ç¤ºã€ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ä¿®æ­£ã€ç²—åˆ©ç‡è¡¨ç¤ºï¼‰
- V1.58: ç®¡ç†å£²ä¸Šäºˆç®—ï¼ˆManagementBudgetãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ç›®æ¨™ç®¡ç†ï¼‰ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼PLå††ã‚°ãƒ©ãƒ•ã€ç²—åˆ©æ§‹æˆæ¯”
- V1.581: å•†å“äºˆç®—è¨­å®šã®æœªä¿å­˜å¤‰æ›´ç ´æ£„é˜²æ­¢
- **V1.6: çµ±åˆç‰ˆï¼ˆV1.5ã€œV1.581ã®å…¨å·®åˆ†ã‚’çµ±åˆï¼‰**

---

## 1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Frontend**: Next.js 14 (App Router), React 18, Tailwind CSS
- **Backend**: Next.js API Routes (Route Handlers), Prisma ORM
- **Database**: SQLite
- **CSV Parsing**: PapaParse + ã‚«ã‚¹ã‚¿ãƒ å‰å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- **Authentication**: NextAuth.js (Credentials Provider)
- **Password**: bcrypt (ãƒãƒƒã‚·ãƒ¥åŒ–)
- **Charts**: Rechartsï¼ˆReactå°‚ç”¨è¨­è¨ˆã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
- **NEé€£æº**: ãƒã‚¯ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ³APIï¼ˆOAuth 2.0ï¼‰

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ (Prisma Schema)

### 2-1. Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
```prisma
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String   // bcryptãƒãƒƒã‚·ãƒ¥
  role      String   // 'master' | 'staff'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  adBudgets AdBudget[]
}
```

### 2-2. Productï¼ˆå•†å“ãƒã‚¹ã‚¿ï¼‰
```prisma
model Product {
  productCode        String   @id
  name               String
  priceExclTax       Float    // è²©å£²ä¾¡æ ¼ï¼ˆç¨åˆ¥ï¼‰
  costExclTax        Float    // åŸä¾¡ï¼ˆç¨åˆ¥ï¼‰
  isSelfManufactured Boolean  @default(true) // è‡ªç¤¾å•†å“ã‹
  managementStatus   String   @default("active") // 'active' | 'inactive'
  categoryId         Int?     @map("category_id") // ã‚«ãƒ†ã‚´ãƒªãƒ¼IDï¼ˆNULLè¨±å®¹ï¼‰
  asin               String?  @unique  // Amazon ASINï¼ˆNULLè¨±å¯ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼‰
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  category           ProductCategory? @relation(fields: [categoryId], references: [id])
  salesRecords       SalesRecord[]
  budgets            Budget[]
}
```

### 2-3. ProductCategoryï¼ˆå•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰
```prisma
model ProductCategory {
  id           Int       @id @default(autoincrement())
  name         String    // ã‚«ãƒ†ã‚´ãƒªãƒ¼å
  displayOrder Int       @default(0) @map("display_order") // è¡¨ç¤ºé †åº
  isActive     Boolean   @default(true) @map("is_active") // æœ‰åŠ¹/ç„¡åŠ¹
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  products     Product[]
  
  @@map("product_categories")
}
```

### 2-4. SalesChannelï¼ˆè²©è·¯ãƒã‚¹ã‚¿ï¼‰
```prisma
model SalesChannel {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  salesRecords    SalesRecord[]
  importHistories ImportHistory[]
  neShopMappings  NEShopMapping[]
}
```
**åˆæœŸãƒ‡ãƒ¼ã‚¿**: EC, ãƒ¢ãƒ¼ãƒ«, å¸, å‚¬äº‹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—, ãã®ä»–

### 2-5. SalesRecordï¼ˆå£²ä¸Šå®Ÿç¸¾ï¼‰
```prisma
model SalesRecord {
  id                 Int           @id @default(autoincrement())
  productCode        String
  quantity           Int
  salesAmountExclTax Float         // ç¨æŠœå£²ä¸Š
  costAmountExclTax  Float         // ç¨æŠœåŸä¾¡
  grossProfit        Float         // ç²—åˆ©
  periodYm           String        // YYYY-MM
  salesDate          DateTime?     // å°†æ¥ã®æ—¥æ¬¡åˆ†æç”¨ï¼ˆNULLè¨±å¯ï¼‰
  importHistoryId    Int
  salesChannelId     Int
  externalOrderId    String?  @unique @map("external_order_id") // NEå—æ³¨æ˜ç´°IDï¼ˆäºŒé‡å–è¾¼é˜²æ­¢ï¼‰
  createdAt          DateTime      @default(now())
  
  product        Product       @relation(fields: [productCode], references: [productCode])
  importHistory  ImportHistory @relation(fields: [importHistoryId], references: [id], onDelete: Cascade)
  salesChannel   SalesChannel  @relation(fields: [salesChannelId], references: [id])
}
```

### 2-6. ImportHistoryï¼ˆå–è¾¼å±¥æ­´ï¼‰
```prisma
model ImportHistory {
  id             Int          @id @default(autoincrement())
  importType     String       // 'sales' | 'products' | 'ads'
  targetYm       String       // YYYY-MM
  importMode     String       // 'append' | 'overwrite'
  dataSource     String?      // 'NE' | 'Amazon' | 'API'
  salesChannelId Int?
  comment        String?
  recordCount    Int
  userId         Int?
  createdAt      DateTime     @default(now())
  
  salesChannel   SalesChannel? @relation(fields: [salesChannelId], references: [id])
  salesRecords   SalesRecord[]
}
```

### 2-7. Budgetï¼ˆäºˆç®—ï¼‰
```prisma
model Budget {
  id           Int      @id @default(autoincrement())
  productCode  String
  periodYm     String   // YYYY-MM
  quantity     Int
  salesAmount  Float    // äºˆç®—å£²ä¸Šï¼ˆç¨åˆ¥ï¼‰
  costAmount   Float    // äºˆç®—åŸä¾¡ï¼ˆç¨åˆ¥ï¼‰
  grossProfit  Float    // äºˆç®—ç²—åˆ©
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  product      Product  @relation(fields: [productCode], references: [productCode])
  
  @@unique([productCode, periodYm])
}
```

### 2-8. TaxRateï¼ˆç¨ç‡ï¼‰
```prisma
model TaxRate {
  id        Int      @id @default(autoincrement())
  startYm   String   // é©ç”¨é–‹å§‹å¹´æœˆ YYYY-MM
  rate      Float    // ä¾‹: 0.10
  createdAt DateTime @default(now())
}
```

### 2-9. AdCategoryï¼ˆåºƒå‘Šã‚«ãƒ†ã‚´ãƒªï¼‰
```prisma
model AdCategory {
  id           Int         @id @default(autoincrement())
  categoryName String
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  adExpenses   AdExpense[]
  adBudgets    AdBudget[]
}
```
**åˆæœŸãƒ‡ãƒ¼ã‚¿**: Metaåºƒå‘Š, Googleåºƒå‘Š, ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ, ãã®ä»–

### 2-10. AdExpenseï¼ˆåºƒå‘Šè²»ï¼‰
```prisma
model AdExpense {
  id           Int         @id @default(autoincrement())
  expenseDate  DateTime
  amount       Int
  adCategoryId Int
  memo         String?
  createdAt    DateTime    @default(now())
  
  adCategory   AdCategory  @relation(fields: [adCategoryId], references: [id])
}
```

### 2-11. AdBudgetï¼ˆåºƒå‘Šè²»äºˆç®—ï¼‰
```prisma
model AdBudget {
  id              Int        @id @default(autoincrement())
  periodYm        String     @map("period_ym") // YYYY-MM
  adCategoryId    Int        @map("ad_category_id")
  amount          Float      @default(0)
  createdByUserId Int        @map("created_by_user_id")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")

  adCategory      AdCategory @relation(fields: [adCategoryId], references: [id])
  createdBy       User       @relation(fields: [createdByUserId], references: [id])

  @@unique([periodYm, adCategoryId])
  @@map("ad_budgets")
}
```

### 2-12. ManagementBudgetï¼ˆç®¡ç†å£²ä¸Šäºˆç®—ï¼‰
```prisma
model ManagementBudget {
  periodYm    String   @id @map("period_ym") // YYYY-MM
  amount      Float    @default(0)           // ç›®æ¨™å£²ä¸Šï¼ˆç¨åˆ¥ï¼‰
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("management_budgets")
}
```

### 2-13. ExclusionKeywordï¼ˆé™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰
```prisma
model ExclusionKeyword {
  id        Int      @id @default(autoincrement())
  keyword   String   // é™¤å¤–å¯¾è±¡ã®æ–‡å­—åˆ—
  matchType String   // "startsWith" (å‰æ–¹ä¸€è‡´) or "includes" (éƒ¨åˆ†ä¸€è‡´)
  createdAt DateTime @default(now())
}
```

### 2-14. NEAuthï¼ˆNEèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰
```prisma
model NEAuth {
  id            Int      @id @default(1) // å¸¸ã«1ãƒ¬ã‚³ãƒ¼ãƒ‰æƒ³å®š
  accessToken   String
  refreshToken  String
  expiresAt     DateTime // ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™
  refreshesAt   DateTime // ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™ (3æ—¥)
  updatedAt     DateTime @updatedAt
}
```

### 2-15. NEShopMappingï¼ˆNEåº—èˆ—ãƒãƒƒãƒ”ãƒ³ã‚°ï¼‰
```prisma
model NEShopMapping {
  neShopId    Int          @id // NEå´ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªåº—èˆ—ID
  channelId   Int          // Rinoriå´ã®è²©è·¯ID
  channel     SalesChannel @relation(fields: [channelId], references: [id])
}
```

---

## 3. é‡è¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°

### 3-1. SKUâ†’è¦ªã‚³ãƒ¼ãƒ‰å¤‰æ›
```typescript
function convertToParentCode(sku: string): string {
  const trimmed = sku.trim();
  
  // Rule 1: RINO- å½¢å¼
  const rule1 = trimmed.match(/^(RINO-[A-Z0-9]+)/);
  if (rule1) return rule1[1];
  
  // Rule 2: ãƒã‚¤ãƒ•ãƒ³ãªã—å½¢å¼
  const rule2 = trimmed.match(/^(RINO[A-Z]+[0-9]{3,4})/);
  if (rule2) return rule2[1];
  
  // Rule 3: ãã®ä»–
  return trimmed;
}
```

### 3-2. ç¨æŠœæ›ç®—ï¼ˆHALF UPï¼‰
```typescript
function calcExclTax(inclTax: number, taxRate: number): number {
  return Math.round(inclTax / (1 + taxRate));
}
// ä¾‹: calcExclTax(11000, 0.10) â†’ 10000
```

### 3-3. å¯¾è±¡å¹´æœˆã®ç¨ç‡å–å¾—
```typescript
async function getTaxRateForYm(targetYm: string, prisma: PrismaClient): Promise<number> {
  const taxRate = await prisma.taxRate.findFirst({
    where: { startYm: { lte: targetYm } },
    orderBy: { startYm: 'desc' }
  });
  return taxRate?.rate ?? 0.10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ10%
}
```

### 3-4. æœŸé–“äºˆç®—ã®è‡ªå‹•é…åˆ†
```typescript
function distributeBudget(total: number, months: number): number[] {
  const base = Math.floor(total / months);
  const remainder = total % months;
  const result = Array(months).fill(base);
  result[months - 1] += remainder; // ç«¯æ•°ã¯æœ€çµ‚æœˆã«åŠ ç®—
  return result;
}
// ä¾‹: distributeBudget(100, 3) â†’ [33, 33, 34]
```

### 3-5. CSVãƒ‘ãƒ¼ã‚¹å …ç‰¢åŒ–
```typescript
async function parseCSV(file: File): Promise<string[][]> {
  // 1. ãƒã‚¤ãƒŠãƒªå–å¾—
  const buffer = await file.arrayBuffer();
  const uint8 = new Uint8Array(buffer);
  
  // 2. UTF-8ã§ãƒ‡ã‚³ãƒ¼ãƒ‰è©¦è¡Œ
  let text = new TextDecoder('utf-8').decode(uint8);
  let parsed = Papa.parse(text, { header: true });
  
  // 3. ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼ï¼ˆæ–‡å­—åŒ–ã‘åˆ¤å®šï¼‰
  const hasValidHeader = parsed.meta.fields?.some(f => 
    f.includes('å•†å“') || f.includes('SKU') || f.includes('å—æ³¨')
  );
  
  // 4. Shift-JISã§å†è©¦è¡Œ
  if (!hasValidHeader) {
    const decoder = new TextDecoder('shift-jis');
    text = decoder.decode(uint8);
    parsed = Papa.parse(text, { header: true });
  }
  
  // 5. ä¸æ­£ã‚¯ã‚©ãƒ¼ãƒˆè£œæ­£ï¼ˆç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿è­·ï¼‰
  text = text.replace(/([^,\t\r\n])""/g, '$1"');
  
  return Papa.parse(text, { header: true }).data;
}
```

### 3-6. Amazonãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ‘ãƒ¼ã‚¹
```typescript
function parseAmazonNumber(value: string): number {
  if (!value || value === 'ï¿¥0' || value === '0') return 0;
  let cleaned = value.replace(/[ï¿¥Â¥]/g, '');
  cleaned = cleaned.replace(/,/g, '');
  const num = parseInt(cleaned, 10);
  return isNaN(num) ? 0 : num;
}
```

### 3-7. ASIN â†’ è¦ªã‚³ãƒ¼ãƒ‰å¤‰æ›
```typescript
async function convertAsinToProductCode(
  asin: string,
  prisma: PrismaClient
): Promise<string | null> {
  const product = await prisma.product.findFirst({
    where: { asin: asin },
    select: { productCode: true }
  });
  return product?.productCode ?? null;
}
```

### 3-8. Amazon CSVå‡¦ç†ãƒ•ãƒ­ãƒ¼
```typescript
interface AmazonCsvRow {
  productCode: string;
  asin: string;
  title: string;
  quantity: number;
  salesAmountInclTax: number;
  salesAmountExclTax: number;
  costAmountExclTax: number;
  grossProfit: number;
}

async function processAmazonCsv(
  rows: Papa.ParseResult<Record<string, string>>,
  targetYm: string,
  prisma: PrismaClient
): Promise<{
  validRows: AmazonCsvRow[];
  unregisteredAsins: { asin: string; title: string }[];
}> {
  const validRows: AmazonCsvRow[] = [];
  const unregisteredAsins: { asin: string; title: string }[] = [];
  const taxRate = await getTaxRateForYm(targetYm, prisma);
  
  for (const row of rows.data) {
    const asin = row['ï¼ˆè¦ªï¼‰ASIN']?.trim();
    const title = row['ã‚¿ã‚¤ãƒˆãƒ«']?.trim() || '';
    const quantity = parseAmazonNumber(row['æ³¨æ–‡ã•ã‚ŒãŸå•†å“ç‚¹æ•°']);
    const salesAmountInclTax = parseAmazonNumber(row['æ³¨æ–‡å•†å“ã®å£²ä¸Šé¡']);
    
    if (!asin) continue;
    
    const product = await prisma.product.findFirst({
      where: { asin: asin },
      select: { productCode: true, costExclTax: true }
    });
    
    if (product) {
      const salesAmountExclTax = Math.round(salesAmountInclTax / (1 + taxRate));
      const costAmountExclTax = quantity * product.costExclTax;
      const grossProfit = salesAmountExclTax - costAmountExclTax;
      
      validRows.push({
        productCode: product.productCode,
        asin, title, quantity,
        salesAmountInclTax, salesAmountExclTax,
        costAmountExclTax, grossProfit
      });
    } else {
      if (!unregisteredAsins.find(u => u.asin === asin)) {
        unregisteredAsins.push({ asin, title });
      }
    }
  }
  
  return { validRows, unregisteredAsins };
}
```

### 3-9. å•†å“åˆ¥PLã‚½ãƒ¼ãƒˆãƒ­ã‚¸ãƒƒã‚¯
```typescript
const sortPriority = (code: string) => {
  if (code.startsWith('RINO-FR')) return 1;
  if (code.startsWith('RINOBG')) return 2;
  if (code.startsWith('RINO-SY')) return 3;
  return 4;
};
products.sort((a, b) => 
  sortPriority(a.productCode) - sortPriority(b.productCode) 
  || a.productCode.localeCompare(b.productCode)
);
```

### 3-10. é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- CSVãƒ‘ãƒ¼ã‚¹ç›´å¾Œã€SKUæ­£è¦åŒ–ã‚„ãƒã‚¹ã‚¿å‚ç…§ã®**å‰**ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã€‚
- `ExclusionKeyword` ãƒ†ãƒ¼ãƒ–ãƒ«ã®å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€å„è¡Œã®è­˜åˆ¥å­ï¼ˆNE: å•†å“ã‚³ãƒ¼ãƒ‰, Amazon: ASINï¼‰ã¨æ¯”è¼ƒã€‚
- ä¸€è‡´ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯å‡¦ç†å¯¾è±¡ã‹ã‚‰é™¤å¤–ã—ã€`excludedCount` ã¨ã—ã¦é›†è¨ˆçµæœã«å«ã‚ã‚‹ã€‚
- ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦ã¯æ‰±ã‚ãšã€æ­£å¸¸ãªã‚¹ã‚­ãƒƒãƒ—ã¨ã—ã¦å‡¦ç†ã™ã‚‹ã€‚

### 3-11. æœªä¿å­˜å¤‰æ›´ã®æ¤œçŸ¥ï¼ˆå•†å“äºˆç®—è¨­å®šï¼‰
```typescript
// åˆæœŸãƒ‡ãƒ¼ã‚¿ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆå¤‰æ›´æ¤œçŸ¥ç”¨ï¼‰
const initialBudgetDataRef = useRef<string>("");

const isDirty = useCallback(() => {
    if (!initialBudgetDataRef.current) return false;
    const current = JSON.stringify(
      budgetData.map(p => ({ productCode: p.productCode, monthlyQty: p.monthlyQty }))
    );
    return current !== initialBudgetDataRef.current;
}, [budgetData]);
```
- **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: `fetchBudgetData` æˆåŠŸå¾Œã€`handleSave` æˆåŠŸå¾Œã€‚
- **ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: `PeriodNavigator` ã® `onChange` å†…ã§ `isDirty()` ãŒ `true` ã®å ´åˆã« `window.confirm` ã‚’è¡¨ç¤ºã€‚

---

## 4. Web API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 4-1. å£²ä¸ŠCSVå–è¾¼ `POST /api/import/sales`
**Request** (multipart/form-data):
- `file`: CSVãƒ•ã‚¡ã‚¤ãƒ«
- `targetYm`: å¯¾è±¡å¹´æœˆ (YYYY-MM)
- `importMode`: 'append' | 'overwrite'
- `salesChannelId`: è²©è·¯ID (å¿…é ˆ)
- `dataSource`: 'NE' | 'Amazon'
- `comment`: å‚™è€ƒ (ä»»æ„)

**æŒ™å‹•**:
1. `salesChannelId` ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
2. é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ¤å®šï¼ˆSKUæ­£è¦åŒ–å‰ã«å®Ÿè¡Œï¼‰
3. `dataSource` ã«å¿œã˜ã¦ãƒ‘ãƒ¼ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†å²ï¼ˆNE / Amazonï¼‰
4. `overwrite` ãƒ¢ãƒ¼ãƒ‰æ™‚: åŒæœˆãƒ»åŒè²©è·¯ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ãƒ»å±¥æ­´ã‚’ç‰©ç†å‰Šé™¤
5. å„è¡Œã‚’ `SalesRecord` ã¨ã—ã¦ç™»éŒ²
6. `ImportHistory` ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆ`dataSource` ã‚’è¨˜éŒ²ï¼‰

**Responseï¼ˆæ­£å¸¸å®Œäº†ï¼‰**:
```json
{
  "success": true,
  "importedCount": 150,
  "skippedCount": 3,
  "excludedCount": 2,
  "historyId": 42
}
```

**Responseï¼ˆæœªç™»éŒ²ASINæ¤œå‡ºæ™‚ï¼‰**:
```json
{
  "success": false,
  "error": "unregistered_asins",
  "unregisteredAsins": [
    { "asin": "B07W4B3RGM", "title": "å•†å“ã‚¿ã‚¤ãƒˆãƒ«..." }
  ]
}
```

### 4-2. æœªç™»éŒ²ASINã‚¹ã‚­ãƒƒãƒ—ç¢ºèª `POST /api/import/sales/confirm`
**Request**:
```json
{
  "tempFileId": "xxx",
  "skipUnregisteredAsins": true
}
```
**Response**: é€šå¸¸ã®å–è¾¼å®Œäº†ãƒ¬ã‚¹ãƒãƒ³ã‚¹

### 4-3. åºƒå‘Šè²»ç®¡ç† `PUT /api/ad-expenses`
**Request**:
```json
{
  "id": 123,
  "expenseDate": "2025-12-01",
  "amount": 50000,
  "adCategoryId": 1,
  "memo": "Metaåºƒå‘Š 12æœˆåˆ†"
}
```

### 4-4. åºƒå‘Šè²»å‰Šé™¤ `DELETE /api/ad-expenses?id=123`

### 4-5. åºƒå‘Šäºˆç®— CRUD `GET/POST /api/ad-budgets`
- **`GET /api/ad-budgets?periodYm=YYYY-MM`**: æŒ‡å®šæœˆã®å„ã‚«ãƒ†ã‚´ãƒªäºˆç®—ä¸€è¦§ã‚’å–å¾—ã€‚
- **`POST /api/ad-budgets`**: è¤‡æ•°ã‚«ãƒ†ã‚´ãƒªã®äºˆç®—ã‚’ä¸€æ‹¬ä¿å­˜ï¼ˆupsertï¼‰ã€‚
  - Request Body: `{ periodYm, budgets: [{ categoryId, amount }, ...] }`
  - `createdByUserId` ã¯èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰è‡ªå‹•è¨­å®šã€‚

### 4-6. è²©è·¯ãƒã‚¹ã‚¿ `GET/POST/PATCH /api/sales-channels`
- `GET`: ä¸€è¦§å–å¾—ï¼ˆ`?activeOnly=true` ã§æœ‰åŠ¹ã®ã¿ï¼‰
- `POST`: æ–°è¦è¿½åŠ  `{ "name": "æ–°è²©è·¯" }`
- `PATCH /[id]`: æ›´æ–° `{ "name": "å¤‰æ›´å¾Œ", "isActive": false }`

### 4-7. å–è¾¼å±¥æ­´ `GET/PATCH/DELETE /api/import-histories`
- `GET`: ä¸€è¦§å–å¾—ï¼ˆæœ€æ–°100ä»¶ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œã€`dataSource` åˆ—ã‚’å«ã‚€ï¼‰
- `PATCH /[id]/channel`: è²©è·¯ä¸€æ‹¬å¤‰æ›´ `{ "salesChannelId": 2 }`
- `DELETE /[id]`: å–è¾¼å˜ä½å‰Šé™¤ï¼ˆCascadeå‰Šé™¤ã§ç´ã¥ãå£²ä¸Šã‚‚å‰Šé™¤ï¼‰

### 4-8. å•†å“ãƒã‚¹ã‚¿ `GET/PATCH /api/products`
- `GET /api/products`: å•†å“ä¸€è¦§å–å¾—ã€‚
  - `?categoryId={id}`: ã‚«ãƒ†ã‚´ãƒªãƒ¼æ‰€å±å•†å“ã®ã¿å–å¾—
  - `?categoryId=null`: æœªæ‰€å±å•†å“ã®ã¿å–å¾—
- `PATCH /api/products/[productCode]`: å•†å“æ›´æ–°ï¼ˆASINæ›´æ–°å¯¾å¿œã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰

### 4-9. æ–°å•†å“å€™è£œ `GET/PATCH /api/products/candidates`
- `GET ?status=pending|ignored`: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥å€™è£œå–å¾—
- `PATCH /[id]`: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆ`pending` â†” `ignored`ã€ä¸€æ‹¬ç®¡ç†ä¸­/ç®¡ç†å¤–ç™»éŒ²ï¼‰

### 4-10. PLé›†è¨ˆ `GET /api/pl`
**Query Parameters**: `startYm`, `endYm`, `salesChannelId`

**Response**:
```json
{
  "sales": 1000000,
  "cost": 400000,
  "grossProfit": 600000,
  "adExpense": 100000,
  "operatingProfit": 500000,
  "costRate": 0.40,
  "grossProfitRate": 0.60,
  "adExpenseRate": 0.10,
  "operatingProfitRate": 0.50,
  "adBudget": 120000,
  "adVariance": -20000,
  "adAchievementRate": 0.833,
  "operatingProfitBudget": 480000,
  "operatingProfitVariance": 20000,
  "operatingProfitAchievementRate": 1.042
}
```
- **è²©è·¯ãƒ•ã‚£ãƒ«ã‚¿æ™‚**: åºƒå‘Šè²»ãƒ»å–¶æ¥­åˆ©ç›Šã®äºˆå®Ÿæ¯”è¼ƒé …ç›®ã¯ã™ã¹ã¦ `null`ã€‚

### 4-11. å•†å“åˆ¥PL `GET /api/pl/products`
**Query Parameters**: `startYm`, `endYm`, `salesChannelId`

**Response**: å•†å“ã”ã¨ã®è²©å£²æ•°é‡ã€å£²ä¸Šã€åŸä¾¡ã€ç²—åˆ©ã€å¹³å‡å˜ä¾¡ã€åŸä¾¡ç‡ã€ç²—åˆ©ç‡ã€‚ã‚½ãƒ¼ãƒˆã¯ `sortPriority` ãƒ­ã‚¸ãƒƒã‚¯ã«å¾“ã†ã€‚

### 4-12. ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥PL `GET /api/pl/category`
**Query Parameters**: `targetYm`, `sortBy` (`sales`|`grossProfit`|`grossProfitRate`), `sortOrder` (`asc`|`desc`)

**Response**:
```json
[
  {
    "categoryId": 1,
    "categoryName": "ãƒ•ãƒªãƒ¼ã‚ºãƒ‰ãƒ©ã‚¤",
    "sales": 1500000,
    "cogs": 900000,
    "grossProfit": 600000,
    "grossProfitRate": 40.0,
    "salesCompositionRate": 60,
    "grossProfitCompositionRate": 55.5
  }
]
```
- `categoryId` ãŒ `NULL` ã®å•†å“ã¯ã€Œæœªåˆ†é¡ã€ã¨ã—ã¦é›†è¨ˆã€‚
- æ§‹æˆæ¯”: `(å½“è©²ã‚«ãƒ†ã‚´ãƒªãƒ¼ / å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆè¨ˆ) * 100`ã€‚åˆè¨ˆãŒ0ã®å ´åˆã¯ `0` ã‚’è¿”å´ã€‚

### 4-13. ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒã‚¹ã‚¿ç®¡ç†API
- `POST /api/categories`: æ–°è¦ä½œæˆï¼ˆåå‰1ã€œ50æ–‡å­—ã€é‡è¤‡ä¸å¯ã€ãƒã‚¹ã‚¿ãƒ¼æ¨©é™ã®ã¿ï¼‰
- `GET /api/categories`: ä¸€è¦§å–å¾—ï¼ˆ`?includeInactive=true` ã§ç„¡åŠ¹å«ã‚€ã€`displayOrder` æ˜‡é †ï¼‰
- `PUT /api/categories/:id`: æ›´æ–°ï¼ˆãƒã‚¹ã‚¿ãƒ¼æ¨©é™ã®ã¿ï¼‰
- `DELETE /api/categories/:id`: å‰Šé™¤ï¼ˆæ‰€å±å•†å“ã¯ `categoryId=NULL` ã«ç§»è¡Œã€ãƒã‚¹ã‚¿ãƒ¼æ¨©é™ã®ã¿ï¼‰

### 4-14. ã‚«ãƒ†ã‚´ãƒªãƒ¼å•†å“ç´ä»˜ã‘API
- `POST /api/categories/:id/products`: ä¸€æ‹¬ç´ä»˜ã‘ `{ "productIds": [1,2,3] }`
- `DELETE /api/categories/:id/products`: ä¸€æ‹¬è§£é™¤ `{ "productIds": [1,2] }`

### 4-15. é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç®¡ç†API
- `GET /api/settings/exclusion-keywords`: ä¸€è¦§å–å¾—
- `POST /api/settings/exclusion-keywords`: ä½œæˆ
- `DELETE /api/settings/exclusion-keywords/[id]`: å‰Šé™¤

### 4-16. ç®¡ç†å£²ä¸Šäºˆç®—API `GET/POST /api/settings/management-budget`
- **GET**: ç¯„å›²æŒ‡å®šã•ã‚ŒãŸ `periodYm` ã®ç®¡ç†å£²ä¸Šäºˆç®—ã‚’å–å¾—ã€‚
- **POST**: æŒ‡å®šå¹´æœˆã®ç®¡ç†å£²ä¸Šäºˆç®—ã‚’ä¿å­˜ï¼ˆUpsertï¼‰ã€‚ç¨åˆ¥ã€‚ãƒã‚¹ã‚¿ãƒ¼æ¨©é™ã®ã¿ã€‚

### 4-17. äºˆç®—è¨­å®šAPI `GET/POST /api/budget`
- **GET**: `?startYm=&endYm=` ã§æœŸé–“å†…ã®äºˆç®—ãƒ‡ãƒ¼ã‚¿å–å¾—ã€‚`Product` ã® `category` ã‚’ `include` ã—ã€`categoryId` / `categoryName` ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã‚ã‚‹ã€‚
- **POST**: äºˆç®—ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ä¿å­˜ã€‚

### 4-18. äºˆç®—vså®Ÿç¸¾API `GET /api/budget/vs-actual`
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« `budgetGrossProfitRate` / `actualGrossProfitRate` ã‚’è¿½åŠ ã€‚
- `summary` ã«ã‚‚å…¨ä½“å¹³å‡é …ç›®ã‚’å«ã‚€ã€‚

### 4-19. NEèªè¨¼API
- `GET /api/auth/nextengine/login`: NEãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã€‚
- `GET /api/auth/nextengine/callback`: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å—å–ã€ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ã€‚

### 4-20. NEåŒæœŸAPI `POST /api/nextengine/sync`
- **å¯¾è±¡API**: `receiveorder_row/search`ï¼ˆå—æ³¨æ˜ç´°æ¢ç´¢ï¼‰
- **æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿**: `receive_order_date`ï¼ˆæœˆåˆã€œæœˆæœ«ï¼‰ã€`receive_order_order_status_id: 20`ï¼ˆå‡ºè·ç¢ºå®šæ¸ˆï¼‰ã€`receive_order_shop_id`ï¼ˆãƒãƒƒãƒ”ãƒ³ã‚°æ¸ˆã¿åº—èˆ—ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°**:

| Rinori ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | NE API ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å¤‰æ›ãƒ»å‡¦ç† |
| :--- | :--- | :--- |
| å‹ç•ª | `receive_order_row_goods_id` | `convertSkuToParentCode()` é©ç”¨ |
| æ•°é‡ | `receive_order_row_quantity` | |
| ç¨è¾¼é¡ | `receive_order_row_unit_price` Ã— æ•°é‡ | |
| è²©è·¯ | (æŒ‡å®š) | ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠã®è²©è·¯ã‚’é©ç”¨ |
| å¤–éƒ¨æ³¨æ–‡ID | `receive_order_row_id` | é‡è¤‡é˜²æ­¢ç”¨ |

- **åŒæœŸã‚·ãƒ¼ã‚±ãƒ³ã‚¹**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®š â†’ APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆä¸Šæ›¸ãï¼‰ â†’ å…±é€šä¿å­˜å‡¦ç†ã¸å¼•ãæ¸¡ã—
- **éå»ãƒ‡ãƒ¼ã‚¿åŒæœŸ**: æœ€å¤§éå»2å¹´å‰ï¼ˆ2024å¹´1æœˆã€œï¼‰ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§éå»25ãƒ¶æœˆåˆ†ã®æœˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ç”Ÿæˆã€‚

### 4-21. ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿API

#### GET `/api/charts/pl-trend`
PLæ¨ç§»ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã€‚
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `startYm`, `endYm`, `type` (`overall`|`product`|`category`), `ids`, `salesChannelId`
- **æ˜¨å¹´å¯¾æ¯”**: 12ãƒ¶æœˆãƒã‚¤ãƒŠã‚¹ã—ãŸæœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚‚å–å¾—ã€‚å­˜åœ¨ã—ãªã„æœˆã¯ `null`ã€‚
- **è²©è·¯ãƒ•ã‚£ãƒ«ã‚¿æ™‚**: å–¶æ¥­åˆ©ç›Šã¯ `null`ã€‚

#### GET `/api/charts/budget-vs-actual`
äºˆç®—å®Ÿç¸¾æ¨ç§»ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã€‚
- **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `startYm`, `endYm`, `type` (`product`|`category`), `ids`, `salesChannelId`
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: æœˆåˆ¥ã®å®Ÿç¸¾å£²ä¸Š/äºˆç®—å£²ä¸Š/æ˜¨å¹´å£²ä¸Š/å®Ÿç¸¾ç²—åˆ©/äºˆç®—ç²—åˆ©/æ˜¨å¹´ç²—åˆ©/æ•°é‡/é”æˆç‡ã€‚

---

## 5. UI/UXã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 5-1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚«ãƒ†ã‚´ãƒªæ§‹é€ ï¼‰
```tsx
const menuCategories = [
  {
    icon: 'ğŸ“¦', title: 'å•†å“',
    items: [
      { href: '/products', label: 'å•†å“ãƒã‚¹ã‚¿ç®¡ç†' },
      { href: '/import/products', label: 'å•†å“CSVå–è¾¼' },
      { href: '/products/candidates', label: 'æ–°å•†å“å€™è£œ' },
      { href: '/settings/categories', label: 'ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†' }
    ]
  },
  {
    icon: 'ğŸ’°', title: 'å£²ä¸Š',
    items: [
      { href: '/import/sales', label: 'å£²ä¸ŠCSVå–è¾¼' },
      { href: '/settings/nextengine', label: 'NEé€£æºåŒæœŸ' },
      { href: '/import/history', label: 'å–è¾¼å±¥æ­´' }
    ]
  },
  {
    icon: 'ğŸ“Š', title: 'äºˆç®—ãƒ»PL',
    items: [
      { href: '/budget', label: 'äºˆç®—è¨­å®š' },
      { href: '/budget/vs-actual', label: 'å•†å“äºˆç®—vså•†å“å®Ÿç¸¾' },
      { href: '/pl', label: 'æœˆæ¬¡PL' },
      { href: '/pl/products', label: 'å•†å“åˆ¥PL' },
      { href: '/pl/category', label: 'ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥PL' }
    ]
  },
  { icon: 'ğŸ“¢', title: 'åºƒå‘Šè²»ç®¡ç†', items: [{ href: '/ad-expenses', label: 'åºƒå‘Šè²»ç®¡ç†' }] },
  {
    icon: 'âš™ï¸', title: 'è¨­å®š',
    items: [
      { href: '/settings/sales-channels', label: 'è²©è·¯ãƒã‚¹ã‚¿' },
      { href: '/settings/management-budget', label: 'ç®¡ç†å£²ä¸Šäºˆç®—è¨­å®š' },
      { href: '/settings/exclusion-keywords', label: 'é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®š' },
      { href: '/settings/tax-rate', label: 'ç¨ç‡è¨­å®š' },
      { href: '/settings/account', label: 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š' },
      // ãƒã‚¹ã‚¿ãƒ¼æ¨©é™ã®ã¿:
      { href: '/settings/users', label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†' },
      { href: '/settings/export', label: 'ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ' },
      { href: '/settings/restore', label: 'ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ' }
    ]
  }
];
```

### 5-2. æœŸé–“ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### DateNavigatorï¼ˆå˜æœˆé¸æŠï¼‰
`<` (å‰æœˆ) / `YYYY-MM` (ãƒ”ãƒƒã‚«ãƒ¼) / `>` (ç¿Œæœˆ)

#### PeriodNavigatorï¼ˆæœŸé–“é¸æŠï¼‰
`<` (å‰ã®æœŸé–“) / `YYYY-MM` ~ `YYYY-MM` / `>` (æ¬¡ã®æœŸé–“)
ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã¯é–‹å§‹æœˆãƒ»çµ‚äº†æœˆã‚’ãã‚Œãã‚Œ **1ãƒ¶æœˆåˆ†** å‰å¾Œã•ã›ã‚‹ã€‚

### 5-3. å•†å“äºˆç®—è¨­å®šç”»é¢ (SC-09)
- **ç›®æ¨™æ¯”è¼ƒè¡¨ç¤º**: ãƒ˜ãƒƒãƒ€ãƒ¼ã«ç®¡ç†å£²ä¸Šäºˆç®—ï¼ˆç›®æ¨™ï¼‰ãƒ»å…¨ç¤¾å•†å“è¨ˆç”»ï¼ˆè¨ˆç”»ï¼‰ãƒ»ä¹–é›¢é¡ï¼ˆä¸è¶³ï¼‰ã‚’è¡¨ç¤ºã€‚ãƒ•ã‚£ãƒ«ã‚¿ã®å½±éŸ¿ã‚’å—ã‘ãªã„ã€Œä¼šç¤¾å…¨ä½“ã€ã®æ¯”è¼ƒã€‚
- **ã‚¯ã‚¤ãƒƒã‚¯å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ«**: ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç›®æ¨™é‡‘é¡è¡¨ç¤ºã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒé–‹ãã€åˆè¨ˆé¡ã‚’å…¥åŠ›ã™ã‚‹ã¨è¡¨ç¤ºæœˆæ•°ã§å‡ç­‰å‰²ã—ã€æ•´æ•°ï¼ˆå††å˜ä½ï¼‰ã§ä¿å­˜ã€‚ç«¯æ•°ã¯è¡¨ç¤ºæœŸé–“ã®æœ€çµ‚æœˆã«åŠ ç®—ã€‚
- **ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ—**: ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã€Œã‚«ãƒ†ã‚´ãƒªãƒ¼ã€åˆ—ã‚’è¿½åŠ ã€ã‚½ãƒ¼ãƒˆå¯èƒ½ã€‚
- **ã‚µãƒãƒª**: åˆè¨ˆå£²ä¸Šãƒ»åˆè¨ˆç²—åˆ©ãƒ»åŠ é‡å¹³å‡ç²—åˆ©ç‡ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿çµæœã«åŸºã¥ãå‹•çš„è¨ˆç®—ï¼‰ã€‚
- **æœªä¿å­˜å¤‰æ›´ã®ç ´æ£„é˜²æ­¢**: æœŸé–“ç§»å‹•æ™‚ã« `isDirty()` ãƒã‚§ãƒƒã‚¯ â†’ `window.confirm` è¡¨ç¤ºã€‚

### 5-4. å•†å“äºˆç®—vså•†å“å®Ÿç¸¾ (SC-11)
```tsx
const [hideZeroRows, setHideZeroRows] = useState(true);
const filteredData = hideZeroRows 
  ? data.filter(row => row.budgetQty !== 0 || row.actualQty !== 0 || row.budgetSales !== 0 || row.actualSales !== 0)
  : data;
```
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœŸé–“**: å…ˆæœˆã€œå…ˆæœˆã€‚
- **ç²—åˆ©ç‡åˆ—**: äºˆç®—ç²—åˆ©ç‡ãƒ»å®Ÿç¸¾ç²—åˆ©ç‡ã‚’ä¸¦è¨˜ï¼ˆå°æ•°ç‚¹ç¬¬1ä½ï¼‰ã€‚

### 5-5. PLåˆ†æã‹ã‚‰å•†å“åˆ¥PLã¸ã®å°ç·š
- PLåˆ†æç”»é¢ã§é¸æŠä¸­ã®ã€ŒæœŸé–“ (`startYm`, `endYm`)ã€ã¨ã€Œè²©è·¯ (`salesChannelId`)ã€ã‚’ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å¼•ãç¶™ãã€å•†å“åˆ¥PLç”»é¢ã¸é·ç§»ã™ã‚‹ã€‚

### 5-6. æœŸé–“PLï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¸æŠï¼‰
```tsx
const [periodType, setPeriodType] = useState<'preset' | 'custom'>('preset');
const [presetValue, setPresetValue] = useState('1month');
```
- éé¸æŠå´ã¯disabled + ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã€‚
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœŸé–“**: å…ˆæœˆï¼ˆå‰æœˆï¼‰ã€‚

### 5-7. PLç”»é¢ã®äºˆå®Ÿãƒ†ãƒ¼ãƒ–ãƒ«

| é …ç›® | å®Ÿç¸¾ | äºˆç®— | å·®ç•° | é”æˆç‡ |
| :--- | :--- | :--- | :--- | :--- |
| å£²ä¸Š | ... | - | - | - |
| åŸä¾¡ | ... | - | - | - |
| ç²—åˆ© | ... | (å•†å“äºˆç®—ç²—åˆ©) | (å·®ç•°) | ... |
| **åºƒå‘Šè²»** | ... | **(åºƒå‘Šäºˆç®—åˆè¨ˆ)** | **(å®Ÿç¸¾-äºˆç®—)** | ... |
| **å–¶æ¥­åˆ©ç›Š** | ... | **(ç²—åˆ©äºˆ-åºƒå‘Šäºˆ)** | **(å®Ÿç¸¾-äºˆç®—)** | ... |

- é”æˆç‡: äºˆç®—ãŒ0ã®å ´åˆã¯ `-` ã¾ãŸã¯ `0%`ï¼ˆã‚¼ãƒ­é™¤ç®—å›é¿ï¼‰ã€‚
- **å·®ç•°ã®è‰²è§£é‡ˆ**: åºƒå‘Šè²»ã®å·®ç•°ï¼ˆå®Ÿç¸¾ï¼äºˆç®—ï¼‰ãŒæ­£ï¼ˆè¶…éï¼‰ã®å ´åˆã¯èµ¤å­—è¡¨ç¤ºã€å–¶æ¥­åˆ©ç›Šã®å·®ç•°ãŒæ­£ï¼ˆå¥½èª¿ï¼‰ã®å ´åˆã¯é’å­—è¡¨ç¤ºã€‚
- è²©è·¯ãƒ•ã‚£ãƒ«ã‚¿æ™‚: äºˆå®Ÿæ¯”è¼ƒé …ç›®ã¯éè¡¨ç¤ºã€‚

### 5-8. åºƒå‘Šè²»ç®¡ç†ï¼ˆã‚¿ãƒ–æ–¹å¼ï¼‰
```tsx
const [activeTab, setActiveTab] = useState<'expenses' | 'categories' | 'budget'>('expenses');
```
- **ã‚¿ãƒ–1: åºƒå‘Šè²»ä¸€è¦§** â€” ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ï¼ˆå½“æ—¥ or è¡¨ç¤ºæœˆ1æ—¥ï¼‰
- **ã‚¿ãƒ–2: ã‚«ãƒ†ã‚´ãƒªç®¡ç†** â€” ã‚«ãƒ†ã‚´ãƒªåç·¨é›†ãƒ»è¿½åŠ ãƒ»å‰Šé™¤
- **ã‚¿ãƒ–3: åºƒå‘Šäºˆç®—è¨­å®š** â€” `DateNavigator` ã§å¹´æœˆé¸æŠã€ã‚«ãƒ†ã‚´ãƒªåˆ¥äºˆç®—å…¥åŠ›
- **ã‚µãƒãƒªãƒ‘ãƒãƒ«**ï¼ˆã‚¿ãƒ–1ä¸Šéƒ¨ï¼‰: ç·äºˆç®—ãƒ»å®Ÿç¸¾åˆè¨ˆãƒ»äºˆç®—æ®‹é«˜ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ã‚‚é–²è¦§å¯ã€è¶…éæ™‚ã¯èµ¤è‰²è¡¨ç¤ºï¼‰

### 5-9. ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†ç”»é¢
**ç”»é¢ãƒ‘ã‚¹**: `/settings/categories`

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**:
- å·¦å´: ã‚«ãƒ†ã‚´ãƒªãƒ¼ä¸€è¦§ï¼ˆä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰
- å³å´: é¸æŠä¸­ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®æ‰€å±å•†å“ä¸€è¦§
- ä¸‹éƒ¨: æœªæ‰€å±å•†å“ä¸€è¦§ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‹ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã§ä¸€æ‹¬ç™»éŒ²ï¼‰

**æ“ä½œãƒ•ãƒ­ãƒ¼**:
1. å·¦å´ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ä¸€è¦§ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ
2. å³å´ã«ã€Œæ‰€å±å•†å“ã€ã¨ã€Œæœªæ‰€å±å•†å“ã€ãŒè¡¨ç¤º
3. æœªæ‰€å±å•†å“ã‚’ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§è¤‡æ•°é¸æŠ â†’ ã€Œé¸æŠã—ãŸå•†å“ã‚’è¿½åŠ ã€ã§ä¸€æ‹¬ç™»éŒ²
4. æ‰€å±å•†å“ã‚’é¸æŠ â†’ ã€Œé¸æŠã‚’è§£é™¤ã€ã§å‰Šé™¤

### 5-10. ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥PLåˆ†æç”»é¢
- **ãƒ†ãƒ¼ãƒ–ãƒ«**: ã‚«ãƒ†ã‚´ãƒªãƒ¼åã€å£²ä¸Šé«˜ã€å£²ä¸ŠåŸä¾¡ã€ç²—åˆ©ã€ç²—åˆ©ç‡ã€å£²ä¸Šæ§‹æˆæ¯”ã€ç²—åˆ©æ§‹æˆæ¯”ã€‚
- **æ§‹æˆæ¯”è¡¨ç¤º**: `Â¥1,234,567 (12%)`ï¼ˆæ•´æ•°ä¸¸ã‚ï¼‰ã€‚
- **ã‚°ãƒ©ãƒ•ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—**: Rechartsã® `Tooltip` ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã€å£²ä¸Šé«˜ã®é …ç›®ã«æ§‹æˆæ¯”ã‚’ä½µè¨˜ã™ã‚‹ã€‚
- **å††ã‚°ãƒ©ãƒ•ï¼ˆPieChartï¼‰**:
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆæœ€å¤§5ä»¶ï¼‰ï¼‹ã€Œãã®ä»–ã€ï¼ˆåˆè¨ˆ6ã‚¹ãƒ©ã‚¤ã‚¹ï¼‰ã€‚
  - ã€Œå£²ä¸Šæ§‹æˆæ¯”ã€ã¨ã€Œç²—åˆ©æ§‹æˆæ¯”ã€ã‚’åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã€‚å°æ•°ç‚¹ç¬¬ä¸€ä½ã¾ã§è¡¨ç¤ºã€‚
  - ç²—åˆ©ç›ŠãŒãƒã‚¤ãƒŠã‚¹ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼ã¯ã‚°ãƒ©ãƒ•æç”»ã‹ã‚‰é™¤å¤–ã—æ³¨é‡ˆè¡¨ç¤ºã€‚
  - æœŸé–“å¤‰æ›´ãƒ»è²©è·¯ãƒ•ã‚£ãƒ«ã‚¿ã«é€£å‹•ã—ã¦å‹•çš„æ›´æ–°ã€‚

### 5-11. å•†å“ãƒã‚¹ã‚¿CSVå–è¾¼ã®å®‰å…¨è£…ç½®
- **ã‚«ãƒ†ã‚´ãƒªãƒ¼ç…§åˆãƒ­ã‚¸ãƒƒã‚¯**: å–è¾¼æ™‚ã®å·®åˆ†ãƒã‚§ãƒƒã‚¯ï¼ˆ`/api/products/import/check`ï¼‰ã«ãŠã„ã¦ã€CSVã®ã‚«ãƒ†ã‚´ãƒªãƒ¼åã‚’ç¾åœ¨ã® `ProductCategory` é …ç›®ã¨ç…§åˆã€‚DBã«å­˜åœ¨ã—ãªã„ã‚«ãƒ†ã‚´ãƒªãƒ¼åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®è¡Œã‚’ã€Œã‚¨ãƒ©ãƒ¼ï¼ˆè­¦å‘Šï¼‰ã€ã¨ã—ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ç„¡åŠ¹åŒ–ã—ã¦ç™»éŒ²ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹ã€‚ã‚«ãƒ†ã‚´ãƒªãƒ¼åãŒç©ºæ¬„ã®å ´åˆã¯ã€Œæœªåˆ†é¡ï¼ˆNULLï¼‰ã€ã¨ã—ã¦æ‰±ã†ã€‚
- **æ–‡å­—ã‚³ãƒ¼ãƒ‰è‡ªå‹•åˆ¤åˆ¥**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å–è¾¼æ™‚ã« `TextDecoder` ã‚’ä½¿ç”¨ã€‚`Uint8Array` ã®å…ˆé ­3ãƒã‚¤ãƒˆã§BOM (0xEF, 0xBB, 0xBF) ã‚’åˆ¤å®šã—ã€ãªã‘ã‚Œã° Shift-JIS ã¨ UTF-8 ã®ãƒ‡ã‚³ãƒ¼ãƒ‰è©¦è¡Œã§åˆ¤åˆ¥ã™ã‚‹ã€‚

### 5-12. å•†å“ãƒã‚¹ã‚¿CSVå‡ºåŠ›
- **å®Ÿè£…å ´æ‰€**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (`/products/page.tsx`)
- **æ–¹å¼**: `papaparse` ã‚’ä½¿ç”¨ã—ã€ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ `filteredProducts` ã‚¹ãƒ†ãƒ¼ãƒˆã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§CSVå¤‰æ›ã€‚
- **ãƒ•ã‚¡ã‚¤ãƒ«å**: `rinori_products_YYYYMMDD.csv`
- **æ–‡å­—ã‚³ãƒ¼ãƒ‰**: UTF-8ï¼ˆBOMä»˜ãï¼‰
- **å‡ºåŠ›åˆ—**: ã‚³ãƒ¼ãƒ‰, åç§°, ASIN, è²©å£²ä¾¡æ ¼, åŸä¾¡, åŒºåˆ†, ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, ã‚«ãƒ†ã‚´ãƒªãƒ¼å
- **å€¤ã®å¤‰æ›**: åŒºåˆ†: `own` â†’ "è‡ªç¤¾", `purchase` â†’ "ä»•å…¥" / ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `managed` â†’ "ç®¡ç†ä¸­", `unmanaged` â†’ "ç®¡ç†å¤–"

### 5-13. å£²ä¸ŠCSVå–è¾¼ç”»é¢
- ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹é¸æŠï¼ˆNE / Amazonï¼‰ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã€‚
- æœªç™»éŒ²ASINè­¦å‘Šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§ASINãƒ»ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºã€ã€Œç¶šè¡Œã€/ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³ï¼‰ã€‚

### 5-14. å•†å“ãƒã‚¹ã‚¿ç·¨é›†ï¼ˆASINåˆ—ï¼‰
- å•†å“ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã«ASINå…¥åŠ›æ¬„ã‚’è¿½åŠ ã€‚ASINé‡è¤‡æ™‚ã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€‚

### 5-15. å–è¾¼å±¥æ­´ç”»é¢
- ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã€Œãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã€åˆ—ã‚’è¿½åŠ ï¼ˆ`dataSource || 'NE'` ã§è¡¨ç¤ºï¼‰ã€‚

### 5-16. æ–°å•†å“å€™è£œä¸€è¦§
- **ã‚¿ãƒ–æ§‹æˆ**: ã€Œæœªç™»éŒ²ï¼ˆpendingï¼‰ã€ã‚¿ãƒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰/ ã€Œç„¡è¦–ãƒªã‚¹ãƒˆï¼ˆignoredï¼‰ã€ã‚¿ãƒ–ã€‚
- **ä¸€æ‹¬æ“ä½œ**: ç®¡ç†ä¸­ç™»éŒ² / ç®¡ç†å¤–ç™»éŒ² / ç„¡è¦– / æœªç™»éŒ²æˆ»ã—ã€‚

### 5-17. ç®¡ç†å£²ä¸Šäºˆç®—è¨­å®šç”»é¢
**ãƒ‘ã‚¹**: `/settings/management-budget`
- å¹´åº¦ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã€å¹´åº¦å…¨ä½“åˆè¨ˆã€å››åŠæœŸåˆè¨ˆ(Q1-Q4)ã€å„æœˆ(1-12)ã®å…¥åŠ›æ¬„ã€‚
- å¹´åº¦/å››åŠæœŸå…¥åŠ›æ™‚: æœˆåˆ¥ã¸è‡ªå‹•æ¡ˆåˆ†ï¼ˆç«¯æ•°æœ€çµ‚æœˆå¯„ã›ï¼‰ã€‚
- æœˆåˆ¥å…¥åŠ›æ™‚: ä¸Šä½ã®å››åŠæœŸ/å¹´åº¦åˆè¨ˆå€¤ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«åˆç®—ã€‚

### 5-18. NEé€£æºè¨­å®šç”»é¢
- **åŒæœŸå®Ÿè¡Œç”»é¢**: æœˆé¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆéå»25ãƒ¶æœˆåˆ†ï¼‰ã€è²©è·¯é¸æŠã€åŒæœŸå®Ÿè¡Œãƒœã‚¿ãƒ³ã€‚å‡¦ç†ä¸­ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°UIã€‚
- **åº—èˆ—ãƒãƒƒãƒ”ãƒ³ã‚°è¨­å®š**: NEåº—èˆ—IDã€NEåº—èˆ—åã€Rinoriè²©è·¯é¸æŠï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰ã€‚åº—èˆ—åã¯ `shop/search` APIã‹ã‚‰å–å¾—ã€‚

---

## 6. ã‚°ãƒ©ãƒ•å…±é€šè¨­è¨ˆ

### 6-1. å…±é€šã‚°ãƒ©ãƒ•ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`ChartSection.tsx`)
- **é…ç½®**: è¡¨ï¼ˆTableï¼‰ã®ç›´ä¸‹ã«ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å½¢å¼ã§é…ç½®ã€‚
- **åˆæœŸçŠ¶æ…‹**: é–‹ï¼ˆOpenï¼‰ã€‚
- **æ©Ÿèƒ½**: è¡¨ç¤ºé …ç›®ã®ã‚ªãƒ³ã‚ªãƒ•ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰ã€ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã€å‡¡ä¾‹ã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆã€‚
- **Recharts**: `ResponsiveContainer` ã§æç”»ã€`min-height: 400px`ã€‚

### 6-2. æ¯”è¼ƒå¯¾è±¡ã®é¸æŠUI
- ãƒ†ãƒ¼ãƒ–ãƒ«å·¦ç«¯ã«ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’é…ç½®ã€‚æœ€å¤§ **5ä»¶** ã¾ã§é¸æŠå¯èƒ½ã€‚
- 5ä»¶é¸æŠä¸­ã¯ä»–ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’éæ´»æ€§åŒ–ã€‚
- æœªé¸æŠæ™‚ã¯ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ã«ã€Œå·¦ã®è¡¨ã‹ã‚‰æ¯”è¼ƒã—ãŸã„é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§5ä»¶ï¼‰ã€ã‚’è¡¨ç¤ºã€‚

### 6-3. ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—åˆ‡æ›¿
- æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆ`LineChart`ï¼‰ã¨æ£’ã‚°ãƒ©ãƒ•ï¼ˆ`BarChart`ï¼‰ã‚’ãƒˆã‚°ãƒ«ã§åˆ‡ã‚Šæ›¿ãˆã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯æŠ˜ã‚Œç·šã€‚
- æ£’ã‚°ãƒ©ãƒ•é¸æŠæ™‚ã€è¤‡æ•°å•†å“æ¯”è¼ƒã¯å•†å“ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦è¡¨ç¤ºã€‚

### 6-4. æ˜¨å¹´å¯¾æ¯”ãƒ‡ãƒ¼ã‚¿
- ã€Œæ˜¨å¹´å¯¾æ¯”ã‚’è¡¨ç¤ºã€å…±é€šãƒˆã‚°ãƒ«ã§ä¸€æ‹¬è¡¨ç¤ºåˆ‡æ›¿ã€‚
- æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿ãŒ `null` ã®å ´åˆã¯ `connectNulls={false}` ã§æç”»ã‚¹ã‚­ãƒƒãƒ—ã€‚

### 6-5. ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆï¼ˆæ¯”è¼ƒæ™‚ï¼‰
1. `#3B82F6` (Blue)
2. `#10B981` (Green)
3. `#F59E0B` (Amber)
4. `#8B5CF6` (Violet)
5. `#EF4444` (Red)

### 6-6. Yè»¸ãƒãƒƒãƒ”ãƒ³ã‚°
- **å·¦è»¸ (å††)**: å£²ä¸Šã€ç²—åˆ©ã€å–¶æ¥­åˆ©ç›Šã®å®Ÿç¸¾ãƒ»äºˆç®—ãƒ»æ˜¨å¹´ãƒ‡ãƒ¼ã‚¿ã€‚
- **å³è»¸ (% or å€‹)**: é”æˆç‡ã€ç²—åˆ©ç‡ã€æ•°é‡ã€‚æ•°é‡ã¨åˆ©ç‡ãŒåŒæ™‚é¸æŠã•ã‚ŒãŸå ´åˆã¯æ•°é‡ã‚’å„ªå…ˆã€‚

### 6-7. åˆæœŸè¡¨ç¤ºé …ç›®
- **äºˆç®—å®Ÿç¸¾ã‚°ãƒ©ãƒ• (SC-11)**: å®Ÿç¸¾å£²ä¸Šã€äºˆç®—å£²ä¸Šã€é”æˆç‡(%)ã€‚
- **PLæ¨ç§»ã‚°ãƒ©ãƒ• (SC-12/13)**: å£²ä¸Šé«˜ã€ç²—åˆ©ã€ç²—åˆ©ç‡(%)ã€‚

### 6-8. é›†è¨ˆã®è«–ç†çµåˆãƒ«ãƒ¼ãƒ«
- åŒä¸€é …ç›®å†…ï¼ˆidsï¼‰ã®è¤‡æ•°é¸æŠã¯ **ORæ¡ä»¶**ï¼ˆSQLã® `IN` å¥ï¼‰ã€‚
- é …ç›®é–“ï¼ˆæœŸé–“ã€è²©è·¯ã€å•†å“/ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰ã¯ã™ã¹ã¦ **ANDæ¡ä»¶**ã€‚
- `Budget` ãŠã‚ˆã³ `AdExpense` ã«ã¯ `salesChannelId` ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ç‰¹å®šè²©è·¯ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨æ™‚ã¯ä»¥ä¸‹ã®æŒ™å‹•ã¨ã™ã‚‹:
  - **å®Ÿç¸¾å€¤**: æŒ‡å®šè²©è·¯ã§é›†è¨ˆã€‚
  - **äºˆç®—å€¤ãƒ»åºƒå‘Šè²»**: è²©è·¯åˆ¥ãƒ‡ãƒ¼ã‚¿ãŒãªã„ãŸã‚ã€ã€Œå…¨ä½“(Total)ã€ã®å€¤ã‚’è¡¨ç¤ºã€ã¾ãŸã¯é”æˆç‡/å–¶æ¥­åˆ©ç›Šã‚’ N/A ã¨ã™ã‚‹ã€‚
  - æ­£ç¢ºãªé”æˆç‡ãŠã‚ˆã³å–¶æ¥­åˆ©ç›Šã¯ã€Œè²©è·¯: ã™ã¹ã¦ã€ã®æ™‚ã®ã¿ç®—å‡ºå¯èƒ½ã€‚

### 6-9. è²©è·¯ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨æ™‚ã®UIåˆ¶ç´„
- äºˆç®—ãƒ»é”æˆç‡ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’éæ´»æ€§åŒ–ã€‚
- æ³¨é‡ˆ: ã€Œâ€»è²©è·¯åˆ¥ã®äºˆç®—ãƒ‡ãƒ¼ã‚¿ãŒãªã„ãŸã‚ã€è²©è·¯çµã‚Šè¾¼ã¿ä¸­ã¯äºˆç®—æ¯”è¼ƒã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“ã€ã€‚

### 6-10. å–¶æ¥­åˆ©ç›Šã®è¡¨ç¤ºåˆ¶å¾¡
- å…¨ä½“PLç”»é¢ä»¥å¤–ï¼ˆå•†å“åˆ¥ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ï¼‰ã§ã¯ã€Œå–¶æ¥­åˆ©ç›Šã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’éè¡¨ç¤ºã€‚

### 6-11. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ãƒ‡ãƒ¼ã‚¿æ•´å½¢ï¼ˆRechartså¯¾å¿œï¼‰
- APIã‹ã‚‰è¿”å´ã•ã‚Œã‚‹ã€Œæœˆåˆ¥ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã®è¤‡æ•°å•†å“é…åˆ—ã€ã‚’ã€Rechartsã® `LineChart` / `BarChart` ãŒå‡¦ç†å¯èƒ½ãªãƒ•ãƒ©ãƒƒãƒˆãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã«å¤‰æ›ã™ã‚‹ã€‚
- æ•´å½¢å¾Œã‚¤ãƒ¡ãƒ¼ã‚¸: `{ periodYm: "2025-12", sales_RINO-FR01: 100000, sales_RINO-FR02: 80000, achievement_RINO-FR01: 110.5, ... }`
- `selectedIds` ã‚¹ãƒ†ãƒ¼ãƒˆã«åŸºã¥ã„ã¦ `<Line />` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ«ãƒ¼ãƒ—ã§å‹•çš„ç”Ÿæˆã€‚ãƒ©ã‚¤ãƒ³ã®ãƒ©ãƒ™ãƒ«ï¼ˆå‡¡ä¾‹åï¼‰ã¯ `å•†å“å + é …ç›®å` ã¨ã™ã‚‹ã€‚

### 6-12. æœªåˆ†é¡ã®è­˜åˆ¥å­
- APIã® `ids` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã« `"unclassified"` ã‚’æ¸¡ã™ã¨ã€`categoryId: null` ã®å•†å“ã‚’é›†è¨ˆå¯¾è±¡ã«å«ã‚ã‚‹ã€‚

### 6-13. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- 12ãƒ¶æœˆåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’1ç§’ä»¥å†…ã«æç”»ã€‚
- å¤§é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆå•†å“æ•°100ä»¥ä¸Šã€æœŸé–“24ãƒ¶æœˆä»¥ä¸Šï¼‰ã§ã‚‚3ç§’ä»¥å†…ã«è¡¨ç¤ºã€‚

---

## 7. æ¨©é™åˆ¶å¾¡

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```tsx
const { data: session } = useSession();
const isMaster = session?.user?.role === 'master';

// ç·åˆè¨ˆè¡Œã®è¡¨ç¤ºåˆ¶å¾¡ï¼ˆã‚¹ã‚¿ãƒƒãƒ•ã«ã¯éè¡¨ç¤ºï¼‰
{isMaster && <tr className="font-bold"><td>åˆè¨ˆ</td>...</tr>}

// ãƒã‚¹ã‚¿ãƒ¼å°‚ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼
{isMaster && (
  <>
    <Link href="/settings/users">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</Link>
    <Link href="/settings/export">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</Link>
  </>
)}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```typescript
export async function DELETE(req: Request) {
  const session = await getServerSession(authOptions);
  if (session?.user?.role !== 'master') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
}
```

### æ¨©é™ãƒãƒˆãƒªã‚¯ã‚¹
| æ©Ÿèƒ½ | ãƒã‚¹ã‚¿ãƒ¼ | ã‚¹ã‚¿ãƒƒãƒ• |
|---|---|---|
| ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒã‚¹ã‚¿ç·¨é›† | âœ… | âŒ |
| ç®¡ç†å£²ä¸Šäºˆç®—ã®ç·¨é›† | âœ… | âŒï¼ˆé–²è¦§å¯ï¼‰ |
| åºƒå‘Šäºˆç®—ã®ç™»éŒ²ãƒ»å¤‰æ›´ | âœ… | âŒ |
| åºƒå‘Šè²»å…¥åŠ›ç”»é¢ã®äºˆç®—ã‚µãƒãƒª | âœ… | âœ…ï¼ˆé–²è¦§ã®ã¿ï¼‰ |
| PLç·åˆè¨ˆãƒ»ç‡ã®è¡¨ç¤º | âœ… | âŒ |
| NEé€£æºè¨­å®šãƒ»åŒæœŸ | âœ… | âŒ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | âœ… | âŒ |
| ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/å¾©å…ƒ | âœ… | âŒ |

---

## 8. é™çš„ãƒªã‚½ãƒ¼ã‚¹ã¨åˆæœŸåŒ–

### CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
**é…ç½®**: `public/templates/sales_template.csv`
**ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: Shift-JIS
```csv
å•†å“ã‚³ãƒ¼ãƒ‰,å—æ³¨æ•°,å£²ä¸Šé‡‘é¡ï¼ˆç¨è¾¼ï¼‰,å•†å“å
RINO-FR010-X-BLK,10,50000,ã‚µãƒ³ãƒ—ãƒ«å•†å“1
RINODO002BLK,5,25000,ã‚µãƒ³ãƒ—ãƒ«å•†å“2
```

### seed.jsï¼ˆåˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼‰
```javascript
const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcrypt');
const prisma = new PrismaClient();

async function main() {
  // è²©è·¯ãƒã‚¹ã‚¿
  const channels = ['EC', 'ãƒ¢ãƒ¼ãƒ«', 'å¸', 'å‚¬äº‹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—', 'ãã®ä»–'];
  for (const name of channels) {
    await prisma.salesChannel.upsert({
      where: { name },
      update: { isActive: true },
      create: { name, isActive: true }
    });
  }
  
  // åºƒå‘Šã‚«ãƒ†ã‚´ãƒª
  const categories = ['Metaåºƒå‘Š', 'Googleåºƒå‘Š', 'ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ', 'ãã®ä»–'];
  for (const categoryName of categories) {
    const existing = await prisma.adCategory.findFirst({ where: { categoryName } });
    if (!existing) {
      await prisma.adCategory.create({ data: { categoryName, isActive: true } });
    }
  }
  
  // ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼
  const adminPassword = await bcrypt.hash('admin123', 10);
  await prisma.user.upsert({
    where: { username: 'admin' },
    update: {},
    create: { username: 'admin', password: adminPassword, role: 'master' }
  });
}
```

---

## 9. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†

### å£²ä¸ŠCSVå–è¾¼
| ã‚¨ãƒ©ãƒ¼æ¡ä»¶ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|---|---|
| è²©è·¯æœªé¸æŠ | ã€Œè²©è·¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€ï¼ˆå–è¾¼ãƒœã‚¿ãƒ³disabledï¼‰ |
| CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸æ­£ | ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€å–è¾¼ä¸­æ–­ |
| å¿…é ˆåˆ—ä¸è¶³ï¼ˆNEï¼‰ | ã€Œå•†å“ã‚³ãƒ¼ãƒ‰åˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ |
| å¿…é ˆåˆ—ä¸è¶³ï¼ˆAmazonï¼‰ | ã€Œï¼ˆè¦ªï¼‰ASINåˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ |
| å…¨è¡Œæœªç™»éŒ²ASIN | ã€Œå–ã‚Šè¾¼ã‚ã‚‹å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€ |
| æ•°å€¤ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ | è©²å½“è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã€è­¦å‘Šè¡¨ç¤º |

### å•†å“ãƒã‚¹ã‚¿ï¼ˆASINç™»éŒ²ï¼‰
| ã‚¨ãƒ©ãƒ¼æ¡ä»¶ | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |
|---|---|
| ASINé‡è¤‡ | ã€Œã“ã®ASINã¯æ—¢ã«ä»–ã®å•†å“ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€ |

### åºƒå‘Šè²»
- æ—¥ä»˜æœªå…¥åŠ›: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- é‡‘é¡ãŒ0ä»¥ä¸‹: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- ã‚«ãƒ†ã‚´ãƒªæœªé¸æŠ: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

### åºƒå‘Šäºˆç®—
- äºˆç®—é¡ã«è² ã®å€¤ã‚’è¨±å¯ã—ãªã„ã€‚
- é‡è¤‡ç™»éŒ²ã®é˜²æ­¢ï¼ˆ`@@unique` ã«ã‚ˆã‚‹DBã‚¬ãƒ¼ãƒ‰ï¼‰ã€‚

### ã‚«ãƒ†ã‚´ãƒªãƒ¼
- ã‚«ãƒ†ã‚´ãƒªãƒ¼å: å¿…é ˆã€1ã€œ50æ–‡å­—ã€é‡è¤‡ä¸å¯ã€‚
- å‰Šé™¤æ™‚: ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§æ‰€å±å•†å“æ•°ã‚’è¡¨ç¤ºã€‚

### å–è¾¼å±¥æ­´
- å­˜åœ¨ã—ãªã„è²©è·¯ID: 400 or 404ã‚¨ãƒ©ãƒ¼ã€‚

---

## 10. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§

### Cascadeå‰Šé™¤
- `ImportHistory` å‰Šé™¤æ™‚: ç´ã¥ã `SalesRecord` ã‚’è‡ªå‹•å‰Šé™¤ï¼ˆPrisma `onDelete: Cascade`ï¼‰ã€‚

### ä¸Šæ›¸ããƒ¢ãƒ¼ãƒ‰ã®å‰Šé™¤ç¯„å›²
- ã€Œå¯¾è±¡å¹´æœˆã€ã‹ã¤ã€Œé¸æŠã•ã‚ŒãŸè²©è·¯ã€ã®ã¿ã‚’å‰Šé™¤ã€‚ä»–ã®è²©è·¯ãƒ»ä»–ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ã¯ç ´å£Šã—ãªã„ã€‚
- ç½®ãæ›ãˆå¯¾è±¡ã¨ãªã£ãŸéå»ã®å–è¾¼å±¥æ­´ã‚‚ç‰©ç†å‰Šé™¤ã€‚

### NEåŒæœŸã®äºŒé‡å–è¾¼é˜²æ­¢
- `SalesRecord.externalOrderId` ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã§é‡è¤‡ã‚’é˜²æ­¢ã€‚
- åŒä¸€æœŸé–“ãƒ»è²©è·¯ã®å†åŒæœŸæ™‚ã¯æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãï¼ˆå‰Šé™¤â†’å†ç™»éŒ²ï¼‰ã€‚

### ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨æ™‚ã®ä¿å­˜æ•´åˆæ€§
- æ¤œç´¢ã‚„ãƒ•ã‚£ãƒ«ã‚¿ã§è¡¨ç¤ºã‚’çµã‚Šè¾¼ã‚“ã§ã„ã‚‹æœ€ä¸­ã«ã€Œä¿å­˜ã€ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€éè¡¨ç¤ºã®å•†å“ã®äºˆç®—ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆå¤±ã—ãªã„ã“ã¨ã‚’ä¿è¨¼ã€‚

---

## 11. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»åˆ¶ç´„

### NEé€£æº
- **å€‹äººæƒ…å ±ã®ä¿è­·**: å—æ³¨æ˜ç´°ãƒ™ãƒ¼ã‚¹ã§ã®å–å¾—ã‚’å¾¹åº•ã—ã€å€‹äººã‚’ç‰¹å®šå¯èƒ½ãªæƒ…å ±ã¯å–å¾—æ®µéšã§é™¤å¤–ã€‚
- **ãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°**: åŒæœŸå‡¦ç†å‰ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œã€‚
- **ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒãƒˆå¯¾å¿œ**: APIè² è·åˆ¶é™ï¼ˆ429ã‚¨ãƒ©ãƒ¼ç­‰ï¼‰ã‚’è€ƒæ…®ã—ã€ãƒªãƒˆãƒ©ã‚¤ã‚„å¾…æ©Ÿå‡¦ç†ã‚’å®Ÿè£…ã€‚
- **é€šä¿¡ä¸­æ–­**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã¯åŒæœŸã‚’ä¸­æ–­ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’é€šçŸ¥ã€‚
- **è‡ªå‹•åŒæœŸã®é™¤å¤–**: è‡ªå‹•åŒæœŸï¼ˆCronç­‰ï¼‰ã‚„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã®è‡ªå‹•è¿½è·¡ã¯ã€æœ¬ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯é™¤å¤–ãƒ»å°†æ¥èª²é¡Œã¨ã™ã‚‹ã€‚

### SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
- Prisma ORMã‚’ä½¿ç”¨ã—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã§å®Ÿè£…ã€‚

---

## 12. ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°è¡¨ (DB â†’ API)

| APIãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(JSON) | DBãƒ†ãƒ¼ãƒ–ãƒ«.ã‚«ãƒ©ãƒ  | å‚™è€ƒ |
| :--- | :--- | :--- |
| `sales` / `actualSales` | `SalesRecord.salesAmountExclTax` | å®Ÿç¸¾å£²ä¸Š |
| `grossProfit` / `actualGrossProfit` | `SalesRecord.grossProfit` | å®Ÿç¸¾ç²—åˆ© |
| `quantity` / `actualQuantity` | `SalesRecord.quantity` | å®Ÿç¸¾æ•°é‡ |
| `budgetSales` | `Budget.salesAmount` | äºˆç®—å£²ä¸Š |
| `budgetGrossProfit` | `Budget.grossProfit` | äºˆç®—ç²—åˆ© |
| `budgetQuantity` | `Budget.quantity` | äºˆç®—æ•°é‡ |
| `sga` | `AdExpense.amount` | åºƒå‘Šè²»åˆè¨ˆ |
| `adBudget` | `AdBudget.amount` | åºƒå‘Šäºˆç®—åˆè¨ˆ |
| `managementBudget` | `ManagementBudget.amount` | ç®¡ç†å£²ä¸Šäºˆç®— |

---

## 13. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´

### V1.51: ASINãƒ»ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¿½åŠ 
```bash
npx prisma migrate dev --name add_asin_and_datasource
```
```sql
ALTER TABLE "Product" ADD COLUMN "asin" TEXT;
CREATE UNIQUE INDEX "Product_asin_key" ON "Product"("asin");
ALTER TABLE "ImportHistory" ADD COLUMN "dataSource" TEXT;
```
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿: `Product.asin` = NULL, `ImportHistory.dataSource` = NULLï¼ˆ'NE'ã¨ã—ã¦è¡¨ç¤ºï¼‰

### V1.52: é™¤å¤–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
```bash
npx prisma migrate dev --name add_exclusion_keywords
```

### V1.53: åºƒå‘Šè²»äºˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
```bash
npx prisma migrate dev --name add_ad_budgets
```

### V1.54: NEé€£æºãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
```bash
npx prisma migrate dev --name add_ne_auth_and_shop_mapping
```
- `NEAuth`, `NEShopMapping` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- `SalesRecord.externalOrderId` ã‚«ãƒ©ãƒ è¿½åŠ 

### V1.55: å•†å“ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
```bash
npx prisma migrate dev --name add_product_categories
```
- `product_categories` ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- `Product.category_id` ã‚«ãƒ©ãƒ è¿½åŠ 
- æ—¢å­˜å•†å“ã¯ `categoryId` = NULLï¼ˆæœªåˆ†é¡ï¼‰

### V1.58: ç®¡ç†å£²ä¸Šäºˆç®—ãƒ†ãƒ¼ãƒ–ãƒ«è¿½åŠ 
```bash
npx prisma migrate dev --name add_management_budgets
```

---

**ä½œæˆæ—¥**: 2026-02-09
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: V1.6ï¼ˆçµ±åˆç‰ˆï¼‰
**çµ±åˆå…ƒãƒãƒ¼ã‚¸ãƒ§ãƒ³**: V1.5 ã€œ V1.581
