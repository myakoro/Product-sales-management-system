# データベース設計レビュー依頼（v1.53: 広告予算管理）

## 1. 相談の背景
売上管理システムにおいて、新たに「広告予算」を管理するテーブル `AdBudget` を追加します。既存の `AdCategory` (広告カテゴリ) および `User` (登録者) とのリレーションを含みます。
既存データ（広告実績、売上実績など）に悪影響を与えない、安全かつ整合性のとれたスキーマ変更であることを確認したいと考えています。

## 2. 検討中のスキーマ案（Prisma）

### 新規追加
```prisma
// 広告予算
model AdBudget {
  id              Int        @id @default(autoincrement())
  periodYm        String     @map("period_ym")       // 予算対象年月 (YYYY-MM)
  adCategoryId    Int        @map("ad_category_id")  // 広告カテゴリID (FK)
  amount          Float      @default(0)             // 予算額
  createdByUserId Int        @map("created_by_user_id") // 登録・更新ユーザー (FK)
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")

  // Relations
  adCategory      AdCategory @relation(fields: [adCategoryId], references: [id])
  createdBy       User       @relation(fields: [createdByUserId], references: [id])

  @@unique([periodYm, adCategoryId]) // 1カテゴリ1ヶ月に対し1予算
  @@map("ad_budgets")
}
```

### 既存モデルへの影響
- `AdCategory`: `adBudgets AdBudget[]` を追加（逆リレーション）
- `User`: `adBudgets AdBudget[]` を追加（逆リレーション）

## 3. レビューしていただきたい点
1.  **ユニーク制約の適切性**: `[periodYm, adCategoryId]` で一意性を担保していますが、運用上これで十分か（例：販路別予算が将来必要になった場合の影響など）。
2.  **データ型の選択**: `amount` を `Float` としていますが、他の実績データ（`SalesRecord.salesAmountExclTax` 等）と合わせて `Float` で統一すべきか、あるいは日本円なので `Int` にすべきか。※現状のシステムは税抜換算で小数点が発生するため `Float` を多用しています。
3.  **マイグレーションの安全性**: SQLite環境において、新規テーブル追加と既存モデルへのリレーション追加（FK追加ではなくバックリレーション追加）が安全に行えるか。
4.  **命名・マッピング規則**: 既存の `schema.prisma` で採用されている snake_case への `@map` / `@@map` 適用の網羅性。

## 4. 補足情報
- **DBエンジン**: SQLite
- **ORM**: Prisma
- **既存データ量**: 数千件程度（小規模）
