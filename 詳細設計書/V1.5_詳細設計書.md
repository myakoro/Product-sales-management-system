# Rinori è²©å£²ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  è©³ç´°è¨­è¨ˆæ›¸ V1.5ï¼ˆçµ±åˆç‰ˆãƒ»å®Œå…¨æ±ºå®šç‰ˆï¼‰

## å¤‰æ›´å±¥æ­´
- V1.4: è²©è·¯ãƒã‚¹ã‚¿ã€è²©è·¯åˆ¥PLã€å–è¾¼å±¥æ­´æ‹¡å¼µã€äºˆç®—vså®Ÿç¸¾0è¡Œãƒ•ã‚£ãƒ«ã‚¿
- V1.4.5: CSVæ§˜å¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€åºƒå‘Šè²»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†æ§‹æˆã€ã‚¿ãƒ–çµ±åˆã€seed.jsåæ˜ 
- V1.5: CSVãƒ‘ãƒ¼ã‚¹å …ç‰¢åŒ–ï¼ˆUTF-8/Shift-JISè‡ªå‹•åˆ¤åˆ¥ã€ä¸æ­£ã‚¯ã‚©ãƒ¼ãƒˆè£œæ­£ã€ç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿è­·ï¼‰

---

## 1. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **Frontend**: Next.js 14 (App Router), React 18, Tailwind CSS
- **Backend**: Next.js API Routes (Route Handlers), Prisma ORM
- **Database**: SQLite
- **CSV Parsing**: PapaParse + ã‚«ã‚¹ã‚¿ãƒ å‰å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
- **Authentication**: NextAuth.js (Credentials Provider)
- **Password**: bcrypt (ãƒãƒƒã‚·ãƒ¥åŒ–)

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç‰©ç†è¨­è¨ˆ (Prisma Schema)

### 2-1. Userï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
```prisma
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String   // bcryptãƒãƒƒã‚·ãƒ¥
  role      String   // 'master' | 'staff'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### 2-2. Productï¼ˆå•†å“ãƒã‚¹ã‚¿ï¼‰
```prisma
model Product {
  productCode        String   @id
  name               String
  priceExclTax       Float    // è²©å£²ä¾¡æ ¼ï¼ˆç¨åˆ¥ï¼‰
  costExclTax        Float    // åŸä¾¡ï¼ˆç¨åˆ¥ï¼‰
  isSelfManufactured Boolean  @default(true) // è‡ªç¤¾å•†å“ã‹
  managementStatus   String   @default("active") // 'active' | 'inactive'
  categoryId         Int?     // å°†æ¥ã®ã‚«ãƒ†ã‚´ãƒªç”¨
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  salesRecords       SalesRecord[]
  budgets            Budget[]
}
```

### 2-3. SalesChannelï¼ˆè²©è·¯ãƒã‚¹ã‚¿ï¼‰
```prisma
model SalesChannel {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  salesRecords    SalesRecord[]
  importHistories ImportHistory[]
}
```
**åˆæœŸãƒ‡ãƒ¼ã‚¿**: EC, ãƒ¢ãƒ¼ãƒ«, å¸, å‚¬äº‹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—, ãã®ä»–

### 2-4. SalesRecordï¼ˆå£²ä¸Šå®Ÿç¸¾ï¼‰
```prisma
model SalesRecord {
  id                 Int           @id @default(autoincrement())
  productCode        String
  quantity           Int
  salesAmountExclTax Float         // ç¨æŠœå£²ä¸Š
  costAmountExclTax  Float         // ç¨æŠœåŸä¾¡
  grossProfit        Float         // ç²—åˆ©
  periodYm           String        // YYYY-MM
  salesDate          DateTime?     // å°†æ¥ã®æ—¥æ¬¡åˆ†æç”¨ï¼ˆNULLè¨±å¯ï¼‰
  importHistoryId    Int
  salesChannelId     Int
  createdAt          DateTime      @default(now())
  
  product        Product       @relation(fields: [productCode], references: [productCode])
  importHistory  ImportHistory @relation(fields: [importHistoryId], references: [id], onDelete: Cascade)
  salesChannel   SalesChannel  @relation(fields: [salesChannelId], references: [id])
}
```

### 2-5. ImportHistoryï¼ˆå–è¾¼å±¥æ­´ï¼‰
```prisma
model ImportHistory {
  id             Int          @id @default(autoincrement())
  importType     String       // 'sales' | 'products' | 'ads'
  targetYm       String       // YYYY-MM
  importMode     String       // 'append' | 'overwrite'
  salesChannelId Int?
  comment        String?
  recordCount    Int
  userId         Int?
  createdAt      DateTime     @default(now())
  
  salesChannel   SalesChannel? @relation(fields: [salesChannelId], references: [id])
  salesRecords   SalesRecord[]
}
```

### 2-6. Budgetï¼ˆäºˆç®—ï¼‰
```prisma
model Budget {
  id           Int      @id @default(autoincrement())
  productCode  String
  periodYm     String   // YYYY-MM
  quantity     Int
  salesAmount  Float    // äºˆç®—å£²ä¸Šï¼ˆç¨åˆ¥ï¼‰
  costAmount   Float    // äºˆç®—åŸä¾¡ï¼ˆç¨åˆ¥ï¼‰
  grossProfit  Float    // äºˆç®—ç²—åˆ©
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  product      Product  @relation(fields: [productCode], references: [productCode])
  
  @@unique([productCode, periodYm])
}
```

### 2-7. TaxRateï¼ˆç¨ç‡ï¼‰
```prisma
model TaxRate {
  id        Int      @id @default(autoincrement())
  startYm   String   // é©ç”¨é–‹å§‹å¹´æœˆ YYYY-MM
  rate      Float    // ä¾‹: 0.10
  createdAt DateTime @default(now())
}
```

### 2-8. AdCategoryï¼ˆåºƒå‘Šã‚«ãƒ†ã‚´ãƒªï¼‰
```prisma
model AdCategory {
  id           Int         @id @default(autoincrement())
  categoryName String
  isActive     Boolean     @default(true)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  
  adExpenses   AdExpense[]
}
```
**åˆæœŸãƒ‡ãƒ¼ã‚¿**: Metaåºƒå‘Š, Googleåºƒå‘Š, ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ, ãã®ä»–

### 2-9. AdExpenseï¼ˆåºƒå‘Šè²»ï¼‰
```prisma
model AdExpense {
  id           Int         @id @default(autoincrement())
  expenseDate  DateTime
  amount       Int
  adCategoryId Int
  memo         String?
  createdAt    DateTime    @default(now())
  
  adCategory   AdCategory  @relation(fields: [adCategoryId], references: [id])
}
```

---

## 3. é‡è¦ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è©³ç´°

### 3-1. SKUâ†’è¦ªã‚³ãƒ¼ãƒ‰å¤‰æ›
```typescript
function convertToParentCode(sku: string): string {
  const trimmed = sku.trim();
  
  // Rule 1: RINO- å½¢å¼
  const rule1 = trimmed.match(/^(RINO-[A-Z0-9]+)/);
  if (rule1) return rule1[1];
  
  // Rule 2: ãƒã‚¤ãƒ•ãƒ³ãªã—å½¢å¼
  const rule2 = trimmed.match(/^(RINO[A-Z]+[0-9]{3,4})/);
  if (rule2) return rule2[1];
  
  // Rule 3: ãã®ä»–
  return trimmed;
}
```

### 3-2. ç¨æŠœæ›ç®—ï¼ˆHALF UPï¼‰
```typescript
function calcExclTax(inclTax: number, taxRate: number): number {
  return Math.round(inclTax / (1 + taxRate));
}
// ä¾‹: calcExclTax(11000, 0.10) â†’ 10000
```

### 3-3. æœŸé–“äºˆç®—ã®è‡ªå‹•é…åˆ†
```typescript
function distributeBudget(total: number, months: number): number[] {
  const base = Math.floor(total / months);
  const remainder = total % months;
  const result = Array(months).fill(base);
  result[months - 1] += remainder; // ç«¯æ•°ã¯æœ€çµ‚æœˆã«åŠ ç®—
  return result;
}
// ä¾‹: distributeBudget(100, 3) â†’ [33, 33, 34]
```

### 3-4. CSVãƒ‘ãƒ¼ã‚¹å …ç‰¢åŒ–ã€V1.5ã€‘
```typescript
async function parseCSV(file: File): Promise<string[][]> {
  // 1. ãƒã‚¤ãƒŠãƒªå–å¾—
  const buffer = await file.arrayBuffer();
  const uint8 = new Uint8Array(buffer);
  
  // 2. UTF-8ã§ãƒ‡ã‚³ãƒ¼ãƒ‰è©¦è¡Œ
  let text = new TextDecoder('utf-8').decode(uint8);
  let parsed = Papa.parse(text, { header: true });
  
  // 3. ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼ï¼ˆæ–‡å­—åŒ–ã‘åˆ¤å®šï¼‰
  const hasValidHeader = parsed.meta.fields?.some(f => 
    f.includes('å•†å“') || f.includes('SKU') || f.includes('å—æ³¨')
  );
  
  // 4. Shift-JISã§å†è©¦è¡Œ
  if (!hasValidHeader) {
    const decoder = new TextDecoder('shift-jis');
    text = decoder.decode(uint8);
    parsed = Papa.parse(text, { header: true });
  }
  
  // 5. ä¸æ­£ã‚¯ã‚©ãƒ¼ãƒˆè£œæ­£ï¼ˆç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¿è­·ï¼‰
  text = text.replace(/([^,\t\r\n])""/g, '$1"');
  
  return Papa.parse(text, { header: true }).data;
}
```

---

## 4. Web API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### 4-1. å£²ä¸ŠCSVå–è¾¼ `POST /api/import/sales`
**Request** (multipart/form-data):
- `file`: CSVãƒ•ã‚¡ã‚¤ãƒ«
- `targetYm`: å¯¾è±¡å¹´æœˆ (YYYY-MM)
- `importMode`: 'append' | 'overwrite'
- `salesChannelId`: è²©è·¯ID (å¿…é ˆ)
- `comment`: å‚™è€ƒ (ä»»æ„)

**æŒ™å‹•**:
1. `salesChannelId` ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
2. `overwrite` ãƒ¢ãƒ¼ãƒ‰æ™‚: åŒæœˆãƒ»åŒè²©è·¯ã®æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤
   ```sql
   -- 1. æ—¢å­˜ã® ImportHistory ã‚’ç‰¹å®šï¼ˆimportType='sales'ï¼‰
   -- 2. ãã® ID ã«ç´ã¥ã SalesRecord ã‚’ç‰©ç†å‰Šé™¤
   -- 3. ImportHistory è‡ªä½“ã‚‚ç‰©ç†å‰Šé™¤
   DELETE FROM SalesRecord WHERE periodYm = ? AND salesChannelId = ?
   DELETE FROM ImportHistory WHERE targetYm = ? AND salesChannelId = ? AND importType = 'sales'
   ```
3. CSVãƒ‘ãƒ¼ã‚¹ï¼ˆå …ç‰¢åŒ–ãƒ­ã‚¸ãƒƒã‚¯é©ç”¨ï¼‰
4. å„è¡Œã‚’ `SalesRecord` ã¨ã—ã¦ç™»éŒ²
5. `ImportHistory` ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ

**Response**:
```json
{
  "success": true,
  "importedCount": 150,
  "skippedCount": 3,
  "historyId": 42
}
```

### 4-2. åºƒå‘Šè²»ç®¡ç† `PUT /api/ad-expenses`
**Request**:
```json
{
  "id": 123,
  "expenseDate": "2025-12-01",
  "amount": 50000,
  "adCategoryId": 1,
  "memo": "Metaåºƒå‘Š 12æœˆåˆ†"
}
```

**Response**:
```json
{
  "id": 123,
  "expenseDate": "2025-12-01T00:00:00.000Z",
  "amount": 50000,
  "adCategoryId": 1,
  "memo": "Metaåºƒå‘Š 12æœˆåˆ†"
}
```

### 4-3. åºƒå‘Šè²»å‰Šé™¤ `DELETE /api/ad-expenses?id=123`
**Response**:
```json
{ "success": true }
```

### 4-4. è²©è·¯ãƒã‚¹ã‚¿ `GET/POST/PATCH /api/sales-channels`
- `GET`: ä¸€è¦§å–å¾—ï¼ˆ`?activeOnly=true` ã§æœ‰åŠ¹ã®ã¿ï¼‰
- `POST`: æ–°è¦è¿½åŠ  `{ "name": "æ–°è²©è·¯" }`
- `PATCH /[id]`: æ›´æ–° `{ "name": "å¤‰æ›´å¾Œ", "isActive": false }`

### 4-5. å–è¾¼å±¥æ­´ `GET/PATCH/DELETE /api/import-histories`
- `GET`: ä¸€è¦§å–å¾—ï¼ˆæœ€æ–°100ä»¶ã€ãƒšãƒ¼ã‚¸ãƒ³ã‚°å¯¾å¿œï¼‰
- `PATCH /[id]/channel`: è²©è·¯ä¸€æ‹¬å¤‰æ›´ `{ "salesChannelId": 2 }`
- `DELETE /[id]`: å–è¾¼å˜ä½å‰Šé™¤ï¼ˆCascadeå‰Šé™¤ã§ç´ã¥ãå£²ä¸Šã‚‚å‰Šé™¤ï¼‰

### 4-6. PLé›†è¨ˆ `GET /api/pl`
**Query Parameters**:
- `startYm`, `endYm`: æœŸé–“
- `salesChannelId`: è²©è·¯IDï¼ˆ0ã¾ãŸã¯æœªæŒ‡å®šã§å…¨è²©è·¯ï¼‰

**Response**:
```json
{
  "sales": 1000000,
  "cost": 400000,
  "grossProfit": 600000,
  "adExpense": 100000,      // è²©è·¯æŒ‡å®šæ™‚ã¯null
  "operatingProfit": 500000, // è²©è·¯æŒ‡å®šæ™‚ã¯null
  "costRate": 0.40,
  "grossProfitRate": 0.60,
  "adExpenseRate": 0.10,     // è²©è·¯æŒ‡å®šæ™‚ã¯null
  "operatingProfitRate": 0.50 // è²©è·¯æŒ‡å®šæ™‚ã¯null
}
```

### 4-7. å•†å“åˆ¥PL `GET /api/pl/products`
**Query Parameters**:
- `startYm`, `endYm`: æœŸé–“
- `salesChannelId`: è²©è·¯IDï¼ˆ0ã¾ãŸã¯æœªæŒ‡å®šã§å…¨è²©è·¯ï¼‰

**Response**:
```json
{
  "products": [
    {
      "productCode": "RINO-FR010",
      "name": "å•†å“A",
      "quantity": 100,
      "sales": 500000,
      "cost": 200000,
      "grossProfit": 300000,
      "avgPrice": 5000,
      "costRate": 0.40,
      "grossProfitRate": 0.60
    }
  ]
}
```

**ã‚½ãƒ¼ãƒˆãƒ­ã‚¸ãƒƒã‚¯**:
```typescript
const sortPriority = (code: string) => {
  if (code.startsWith('RINO-FR')) return 1;
  if (code.startsWith('RINOBG')) return 2;
  if (code.startsWith('RINO-SY')) return 3;
  return 4;
};
// å„ªå…ˆåº¦ã§æ¯”è¼ƒã—ã€åŒä¸€å„ªå…ˆåº¦ã¯ã‚³ãƒ¼ãƒ‰ã®æ˜‡é †
products.sort((a, b) => sortPriority(a.productCode) - sortPriority(b.productCode) || a.productCode.localeCompare(b.productCode));
```

---

## 5. UI/UXã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### 5-1. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆã‚«ãƒ†ã‚´ãƒªæ§‹é€ ï¼‰
```tsx
const menuCategories = [
  {
    icon: 'ğŸ“¦',
    title: 'å•†å“',
    items: [
      { href: '/products', label: 'å•†å“ãƒã‚¹ã‚¿ç®¡ç†' },
      { href: '/import/products', label: 'å•†å“CSVå–è¾¼' },
      { href: '/products/candidates', label: 'æ–°å•†å“å€™è£œ' }
    ]
  },
  {
    icon: 'ğŸ’°',
    title: 'å£²ä¸Š',
    items: [
      { href: '/import/sales', label: 'å£²ä¸ŠCSVå–è¾¼' },
      { href: '/import/history', label: 'å–è¾¼å±¥æ­´' }
    ]
  },
  // ... äºˆç®—ãƒ»PLã€åºƒå‘Šè²»ç®¡ç†ã€è¨­å®š
];
```

### 5-2. äºˆç®— vs å®Ÿç¸¾ï¼ˆ0è¡Œãƒ•ã‚£ãƒ«ã‚¿ï¼‰
```tsx
const [hideZeroRows, setHideZeroRows] = useState(true);

const filteredData = hideZeroRows 
  ? data.filter(row => 
      row.budgetQty !== 0 || row.actualQty !== 0 ||
      row.budgetSales !== 0 || row.actualSales !== 0
    )
  : data;
```

### 5-3. æœŸé–“PLï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³é¸æŠï¼‰
```tsx
const [periodType, setPeriodType] = useState<'preset' | 'custom'>('preset');
const [presetValue, setPresetValue] = useState('1month');
const [customStart, setCustomStart] = useState('');
const [customEnd, setCustomEnd] = useState('');

// UI: éé¸æŠå´ã¯disabled + ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆ
<input 
  type="text" 
  value={customStart}
  disabled={periodType !== 'custom'}
  className={periodType !== 'custom' ? 'opacity-50' : ''}
/>
```

### 5-4. åºƒå‘Šè²»ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ç·¨é›†
```tsx
const [editingId, setEditingId] = useState<number | null>(null);
const [editForm, setEditForm] = useState({ date: '', amount: '', categoryId: '', memo: '' });

const startEdit = (expense: AdExpense) => {
  setEditingId(expense.id);
  setEditForm({
    date: expense.expenseDate.slice(0, 10),
    amount: String(expense.amount),
    categoryId: String(expense.adCategoryId),
    memo: expense.memo || ''
  });
};

const handleSave = async () => {
  await fetch('/api/ad-expenses', {
    method: 'PUT',
    body: JSON.stringify({ id: editingId, ...editForm })
  });
  setEditingId(null);
  refetch();
};
```

### 5-5. åºƒå‘Šè²»ç®¡ç†ã‚¿ãƒ–
```tsx
const [activeTab, setActiveTab] = useState<'expenses' | 'categories'>('expenses');

return (
  <div>
    <div className="flex border-b">
      <button 
        onClick={() => setActiveTab('expenses')}
        className={activeTab === 'expenses' ? 'border-b-2 border-blue-600' : ''}
      >
        åºƒå‘Šè²»ä¸€è¦§
      </button>
      <button 
        onClick={() => setActiveTab('categories')}
        className={activeTab === 'categories' ? 'border-b-2 border-blue-600' : ''}
      >
        ã‚«ãƒ†ã‚´ãƒªç®¡ç†
      </button>
    </div>
    {activeTab === 'expenses' ? <ExpensesTab /> : <CategoriesTab />}
  </div>
);
```

---

## 6. æ¨©é™åˆ¶å¾¡

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
```tsx
const { data: session } = useSession();
const isMaster = session?.user?.role === 'master';

// ç·åˆè¨ˆè¡Œã®è¡¨ç¤ºåˆ¶å¾¡
{isMaster && (
  <tr className="font-bold">
    <td>åˆè¨ˆ</td>
    <td>{totalSales.toLocaleString()}å††</td>
    {/* ... */}
  </tr>
)}

// ãƒã‚¹ã‚¿ãƒ¼å°‚ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼
{isMaster && (
  <>
    <Link href="/settings/users">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</Link>
    <Link href="/settings/export">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</Link>
  </>
)}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```typescript
// APIãƒ¬ãƒ™ãƒ«ã§ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
export async function DELETE(req: Request) {
  const session = await getServerSession(authOptions);
  if (session?.user?.role !== 'master') {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  // å‡¦ç†ç¶šè¡Œ
}
```

---

## 7. é™çš„ãƒªã‚½ãƒ¼ã‚¹ã¨åˆæœŸåŒ–

### CSVãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
**é…ç½®**: `public/templates/sales_template.csv`
**ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: Shift-JIS
**å†…å®¹**:
```csv
å•†å“ã‚³ãƒ¼ãƒ‰,å—æ³¨æ•°,å£²ä¸Šé‡‘é¡ï¼ˆç¨è¾¼ï¼‰,å•†å“å
RINO-FR010-X-BLK,10,50000,ã‚µãƒ³ãƒ—ãƒ«å•†å“1
RINODO002BLK,5,25000,ã‚µãƒ³ãƒ—ãƒ«å•†å“2
```

### seed.jsï¼ˆåˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼‰
```javascript
const { PrismaClient } = require('@prisma/client');
const bcrypt = require('bcrypt');
const prisma = new PrismaClient();

async function main() {
  // è²©è·¯ãƒã‚¹ã‚¿
  const channels = ['EC', 'ãƒ¢ãƒ¼ãƒ«', 'å¸', 'å‚¬äº‹ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—', 'ãã®ä»–'];
  for (const name of channels) {
    await prisma.salesChannel.upsert({
      where: { name },
      update: { isActive: true },
      create: { name, isActive: true }
    });
  }
  
  // åºƒå‘Šã‚«ãƒ†ã‚´ãƒª
  const categories = ['Metaåºƒå‘Š', 'Googleåºƒå‘Š', 'ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ', 'ãã®ä»–'];
  for (const categoryName of categories) {
    const existing = await prisma.adCategory.findFirst({ where: { categoryName } });
    if (!existing) {
      await prisma.adCategory.create({ data: { categoryName, isActive: true } });
    }
  }
  
  // ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼
  const adminPassword = await bcrypt.hash('admin123', 10);
  await prisma.user.upsert({
    where: { username: 'admin' },
    update: {},
    create: { username: 'admin', password: adminPassword, role: 'master' }
  });
}
```

---

## 8. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†

### å£²ä¸ŠCSVå–è¾¼
- è²©è·¯æœªé¸æŠ: ã€Œè²©è·¯ã‚’é¸æŠã—ã¦ãã ã•ã„ã€ã‚¨ãƒ©ãƒ¼ã€å–è¾¼ãƒœã‚¿ãƒ³disabled
- CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸æ­£: ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã€å–è¾¼ä¸­æ–­
- å¿…é ˆåˆ—ä¸è¶³: ã€Œå•†å“ã‚³ãƒ¼ãƒ‰åˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€ç­‰ã®ã‚¨ãƒ©ãƒ¼

### åºƒå‘Šè²»
- æ—¥ä»˜æœªå…¥åŠ›: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- é‡‘é¡ãŒ0ä»¥ä¸‹: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
- ã‚«ãƒ†ã‚´ãƒªæœªé¸æŠ: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

### å–è¾¼å±¥æ­´ã®è²©è·¯å¤‰æ›´
- å­˜åœ¨ã—ãªã„è²©è·¯ID: 400 or 404ã‚¨ãƒ©ãƒ¼

---

## 9. ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§

### Cascadeå‰Šé™¤
- `ImportHistory` å‰Šé™¤æ™‚: ç´ã¥ã `SalesRecord` ã‚’è‡ªå‹•å‰Šé™¤
- Prismaã® `onDelete: Cascade` ã§å®Ÿè£…

### ä¸Šæ›¸ããƒ¢ãƒ¼ãƒ‰ã®å‰Šé™¤ç¯„å›²
- ã€Œå¯¾è±¡å¹´æœˆã€ã‹ã¤ã€Œé¸æŠã•ã‚ŒãŸè²©è·¯ã€ã®ã¿ã‚’å‰Šé™¤
- ä»–ã®è²©è·¯ãƒ»ä»–ã®æœˆã®ãƒ‡ãƒ¼ã‚¿ã¯ç ´å£Šã—ãªã„

---
ä»¥ä¸Š
