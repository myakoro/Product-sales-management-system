# テスト実施報告書兼改修事項リスト

## 1. 概要
テスト仕様書に基づき、`Rinori 売上管理システム` の現状確認およびテストを実施しました。
その結果、いくつかの未実装機能および不具合（仕様不適合）を確認しました。

## 2. 実装状況サマリ

| 機能ID | 機能名 | 実装状況 | 備考 |
|---|---|---|---|
| COM | 共通・認証 | ❌ **未実装/不適合** | ログイン機能が存在せず、全画面が認証なしでアクセス可能 |
| SC-01 | ダッシュボード | ⚠️ 一部動作確認 | 現在月(システム日時)のデータのみ対象。表示ロジックは実装済み |
| SC-02 | 売上CSV取込 | ✅ 実装済み | バックエンド動作確認済み（API）。UIも実装済み |
| SC-03 | 商品一覧取込 | ❓ 未確認 | ディレクトリ `src/app/products/import` 確認済み |
| SC-05 | 商品マスタ一覧 | ✅ 実装済み | 検索・一覧表示 動作確認済み |
| SC-06 | 商品マスタ編集 | ✅ 実装済み | 新規登録・編集 動作確認済み |
| SC-07 | 新商品候補 | ✅ 実装済み | `newProductCandidate` テーブル連携確認済み |
| SC-09 | 予算設定 | ✅ 実装済み | ディレクトリ `src/app/budget` 確認済み |
| SC-11 | 予算vs実績 | ✅ 実装済み | ディレクトリ `src/app/budget` 確認済み |
| SC-12 | PL（全社） | ✅ 実装済み | ディレクトリ `src/app/pl` 確認済み |
| SC-13 | PL（商品別） | ✅ 実装済み | ディレクトリ `src/app/pl` 確認済み |
| SC-14 | 広告費管理 | ✅ 実装済み | ディレクトリ `src/app/ad-expenses` 確認済み |
| SC-18 | 税率設定 | ❌ **未実装** | 画面・API共に存在しない |

## 3. 改修すべき箇所リスト（不具合・未実装一覧）

### 重要度：High（必須）

1.  **ログイン機能の欠落 (TC-COM-001, 002, 003)**
    *   現在、`/login` ページが存在しません。
    *   全ページ（`/`, `/products` 等）が認証なしでアクセス可能です（セキュリティ不備）。
    *   ヘッダーの「ユーザー: 管理者」は固定表示です。
    *   ログアウトボタンがクリックしても動作しません。
    *   **対策**: NextAuth.js 等を用いた認証機能の実装、ミドルウェアによるページ保護、動的なユーザー情報表示の実装が必要です。

2.  **税率設定機能の未実装 (TC-SC18-*)**
    *   テスト仕様書にある `SC-18 税率設定` 画面（`src/app/tax-rates` 等）が存在しません。
    *   税率マスタ (`tax_rates`) テーブルは定義されていますが、管理するUIがありません。
    *   **対策**: `src/app/tax-rates` の実装が必要です。

### 重要度：Medium

3.  **ユーザーロール制御の欠落**
    *   現在、ログイン概念がないため、マスター権限/スタッフ権限の出し分け（`TC-SC01-002`, `TC-SC12-003` 等）が機能していません。
    *   **対策**: ログイン実装後、ユーザーの `role` に基づくUI制御（条件分岐）を実装する必要があります。

4.  **READMEの更新**
    *   `README.md` の「実装済み機能」リストが実際のコードと乖離しています（多くの機能が実装済みだがチェックされていない）。
    *   **対策**: 現状に合わせて更新を推奨します。

### 重要度：Low / 要確認

5.  **売上取込時のユーザー自動生成**
    *   `src/app/api/sales/import/route.ts` にて、ユーザーが存在しない場合に自動で `admin` ユーザーを作成するロジックがあります。
    *   認証機能実装後は、ログイン中のユーザーIDを使用するように修正する必要があります（現在は `prisma.user.findFirst` で無理やり取得している）。

## 4. 実施したテスト手順詳細

1.  **起動確認**: アプリケーションは正常に起動 (`npm run dev`)。
2.  **画面アクセス確認**: ログインなしでダッシュボード、商品機能、売上取込機能へアクセス可能であることを確認。
3.  **商品登録 (TC-SC06)**: ブラウザ操作により商品登録を試行、正常に動作することを確認。
4.  **売上CSV取込 (TC-SC02)**: テスト用スクリプト (`check-import.js`) を作成し、バックエンドAPIに対してPOSTを実行。正常に取り込まれることを確認。
    *   テストデータ: 2025年10月度
    *   結果: ImportHistory作成、SalesRecord作成を確認。

以上
