# Windsurf AI 実装依頼: ネクストエンジンデータ同期UI

## 📋 依頼概要

**目的**: ネクストエンジン連携設定画面に、受注データ同期機能のUIを実装する

**対象ファイル**: `c:\Users\takuy\Desktop\売上管理システム\rinori-sales-system\src\app\settings\nextengine\page.tsx`

**実装範囲**: 店舗マッピングセクションの下に、データ同期実行UIを追加

---

## 🎯 あなたの役割

あなたは**Rinori売上管理システム**のフロントエンド実装を担当するReact/Next.js開発者です。

**重要な制約**:
- バックエンドAPIは既に完成しているため、**フロントエンドUIの実装のみ**を行う
- 既存のデザインシステムとスタイルに完全に準拠する
- 不明点や判断が必要な箇所は、実装前に必ず質問を返す

---

## 📚 必須参照資料

実装前に以下のファイルを必ず確認してください:

### 1. 詳細設計書（仕様の確認）
**パス**: `c:\Users\takuy\Desktop\売上管理システム\詳細設計書\V1.54_詳細設計_差分.md`
- 79-87行目: UI設計の仕様

### 2. 既存の実装ファイル（デザインシステムの確認）
**パス**: `c:\Users\takuy\Desktop\売上管理システム\rinori-sales-system\src\app\settings\nextengine\page.tsx`
- 既存のスタイル（Tailwind CSS）
- カラーパレット: `#00214d`（メイン）、`#d4af37`（アクセント）
- コンポーネント構造

### 3. バックエンドAPI仕様（既に実装済み）

#### POST `/api/nextengine/sync`
**リクエストボディ**:
```json
{
  "targetYm": "2026-01",
  "channelId": 2
}
```

**レスポンス例（成功）**:
```json
{
  "success": true,
  "recordCount": 150,
  "message": "150件のデータを同期しました"
}
```

**レスポンス例（データなし）**:
```json
{
  "message": "指定された期間・店舗の受注データが見つかりませんでした。",
  "recordCount": 0
}
```

**レスポンス例（エラー）**:
```json
{
  "error": "選択された販路に紐づく店舗が設定されていません。店舗マッピングを設定してください。"
}
```

### 4. 販路（Channel）データの取得
販路一覧は既存のAPIから取得してください:
**エンドポイント**: `GET /api/channels`

---

## 🎨 実装要件

### UI構成

店舗マッピングセクションの下に、以下の構造を追加してください:

```
┌─────────────────────────────────────────────┐
│ データ同期実行                               │
├─────────────────────────────────────────────┤
│ ネクストエンジンから受注データを取得して     │
│ Rinoriに同期します。                         │
├─────────────────────────────────────────────┤
│ 対象月: [▼2026-01]  販路: [▼楽天]          │
│                                             │
│                      [同期実行] ボタン       │
│                                             │
│ ✅ 150件のデータを同期しました               │
└─────────────────────────────────────────────┘
```

### 機能要件

1. **初期表示時の動作**
   - `authStatus.connected === true` の場合のみ、データ同期UIを表示
   - 未接続の場合は、何も表示しない（店舗マッピングセクションまで）

2. **対象月選択**
   - `<select>` プルダウンで実装
   - 過去12ヶ月分を表示（例: 2026-01, 2025-12, ...）
   - 初期値: 当月

3. **販路選択**
   - `<select>` プルダウンで実装
   - `/api/channels` から販路一覧を取得
   - 初期値: 最初の販路

4. **同期実行ボタン**
   - クリックすると `/api/nextengine/sync` にPOSTリクエスト
   - 実行中はローディング表示（ボタンを無効化）
   - 完了後、結果メッセージを表示

5. **結果表示**
   - 成功: 緑色の背景で「✅ XX件のデータを同期しました」
   - データなし: 黄色の背景で「⚠️ 指定された期間・店舗の受注データが見つかりませんでした」
   - エラー: 赤色の背景でエラーメッセージ

### スタイル要件

既存のデザインシステムに準拠してください:

- **カラー**:
  - メインカラー: `#00214d`
  - アクセントカラー: `#d4af37`
  - 背景: `bg-neutral-50`
  - カード: `bg-white` + `shadow-lg` + `border border-neutral-200`

- **ボタンスタイル**:
  - 既存の店舗マッピング保存ボタン（309-320行目）を参考にする
  - プライマリボタン: `bg-[#00214d] text-white hover:bg-[#00337a]`

- **結果表示スタイル**:
  - 成功: `bg-green-50 border border-green-200 text-green-800`
  - 警告: `bg-yellow-50 border border-yellow-200 text-yellow-800`
  - エラー: `bg-red-50 border border-red-200 text-red-800`

---

## ⚠️ 重要な注意事項

### 実装前に質問すべき事項

以下の点について、実装前に必ず確認してください:

1. **対象月の選択範囲**
   - 過去12ヶ月で良いか？
   - それとも、もっと広い範囲が必要か？

2. **同期実行後の動作**
   - 結果メッセージを表示した後、自動的に消すか？
   - それとも、ユーザーが手動で閉じるまで表示し続けるか？

3. **エラー時の再試行**
   - エラーが発生した場合、リトライボタンを表示するか？
   - それとも、もう一度「同期実行」ボタンをクリックしてもらうか？

4. **同期中の表示**
   - ローディング中に進捗バーを表示するか？
   - それとも、シンプルなスピナーで良いか？

### 実装時の制約

- **既存コードの変更範囲**: 店舗マッピングセクションの下に追加（他の部分は変更しない）
- **新規ファイル作成**: 不可（既存ファイルの修正のみ）
- **外部ライブラリ追加**: 不可（既存の依存関係のみ使用）

---

## 📝 実装手順の提案

1. **既存ファイルの確認**
   - 現在の`page.tsx`の全体構造を把握
   - 既存のスタイルパターンを確認

2. **質問の整理**
   - 上記「実装前に質問すべき事項」を確認し、不明点をリストアップ

3. **実装計画の提示**
   - 実装する前に、コンポーネント構造と状態管理の設計を提示
   - ユーザーの承認を得てから実装開始

4. **段階的実装**
   - Step 1: 対象月・販路選択UI
   - Step 2: 同期実行ボタンとAPI呼び出し
   - Step 3: 結果表示
   - 各ステップごとに動作確認

---

## 🚀 開始方法

まず、以下を実行してください:

1. 必須参照資料（詳細設計書、既存実装）を確認
2. 「実装前に質問すべき事項」について、ユーザーに質問を返す
3. 回答を得た後、実装計画を提示
4. 承認を得てから実装開始

**重要**: 勝手に判断せず、不明点は必ず質問してください。
