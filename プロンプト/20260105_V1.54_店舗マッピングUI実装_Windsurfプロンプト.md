# Windsurf AI 実装依頼: ネクストエンジン店舗マッピングUI

## 📋 依頼概要

**目的**: ネクストエンジン連携設定画面に、店舗マッピング機能のUIを実装する

**対象ファイル**: `c:\Users\takuy\Desktop\売上管理システム\rinori-sales-system\src\app\settings\nextengine\page.tsx`

**実装範囲**: 110-114行目のプレースホルダー部分を、実際の店舗マッピングテーブルUIに置き換える

---

## 🎯 あなたの役割

あなたは**Rinori売上管理システム**のフロントエンド実装を担当するReact/Next.js開発者です。

**重要な制約**:
- バックエンドAPIは既に完成しているため、**フロントエンドUIの実装のみ**を行う
- 既存のデザインシステムとスタイルに完全に準拠する
- 不明点や判断が必要な箇所は、実装前に必ず質問を返す

---

## 📚 必須参照資料

実装前に以下のファイルを必ず確認してください:

### 1. 詳細設計書（仕様の確認）
**パス**: `c:\Users\takuy\Desktop\売上管理システム\詳細設計書\V1.54_詳細設計_差分.md`
- 84-87行目: UI設計の仕様
- 18-26行目: データベーススキーマ（NEShopMapping）

### 2. 既存の実装ファイル（デザインシステムの確認）
**パス**: `c:\Users\takuy\Desktop\売上管理システム\rinori-sales-system\src\app\settings\nextengine\page.tsx`
- 既存のスタイル（Tailwind CSS）
- カラーパレット: `#00214d`（メイン）、`#d4af37`（アクセント）
- コンポーネント構造

### 3. バックエンドAPI仕様（既に実装済み）
以下のAPIエンドポイントが利用可能です:

#### GET `/api/nextengine/shops`
**レスポンス例**:
```json
{
  "shops": [
    {
      "shopId": 1,
      "shopName": "楽天市場店"
    },
    {
      "shopId": 2,
      "shopName": "Yahoo!ショッピング店"
    }
  ]
}
```

#### GET `/api/nextengine/mappings`
**レスポンス例**:
```json
{
  "mappings": [
    {
      "neShopId": 1,
      "channelId": 2,
      "channel": {
        "id": 2,
        "name": "楽天"
      }
    }
  ]
}
```

#### POST `/api/nextengine/mappings`
**リクエストボディ**:
```json
{
  "neShopId": 1,
  "channelId": 2
}
```

**レスポンス**:
```json
{
  "success": true,
  "mapping": { ... }
}
```

### 4. 販路（Channel）データの取得
販路一覧は既存のAPIから取得してください:
**エンドポイント**: `GET /api/channels`

---

## 🎨 実装要件

### UI構成

110-114行目のプレースホルダーを以下の構造に置き換えてください:

```
┌─────────────────────────────────────────────┐
│ 店舗マッピング設定                            │
├─────────────────────────────────────────────┤
│ ネクストエンジンの「店舗ID」を、Rinori側の    │
│ どの「販路」として集計するか設定します。      │
├─────────────────────────────────────────────┤
│ ┌─────────┬──────────────┬──────────────┐ │
│ │ NE店舗ID │ NE店舗名      │ Rinori販路    │ │
│ ├─────────┼──────────────┼──────────────┤ │
│ │ 1       │ 楽天市場店    │ [▼楽天]      │ │
│ │ 2       │ Yahoo!店      │ [▼Yahoo]     │ │
│ └─────────┴──────────────┴──────────────┘ │
│                                             │
│                      [保存する] ボタン       │
└─────────────────────────────────────────────┘
```

### 機能要件

1. **初期表示時の動作**
   - `authStatus.connected === true` の場合のみ、店舗マッピングUIを表示
   - 未接続の場合は、現在のプレースホルダーを表示

2. **データ取得**
   - `/api/nextengine/shops` から店舗一覧を取得
   - `/api/nextengine/mappings` から既存のマッピングを取得
   - `/api/channels` から販路一覧を取得

3. **テーブル表示**
   - 各行に「NE店舗ID」「NE店舗名」「Rinori販路選択」を表示
   - 販路選択は `<select>` プルダウンで実装
   - 既存のマッピングがある場合は、該当する販路を初期選択状態にする

4. **保存機能**
   - 「保存する」ボタンをクリックすると、各行のマッピングを `/api/nextengine/mappings` に順次POST
   - 保存中はローディング表示
   - 保存完了後、成功メッセージを表示

### スタイル要件

既存のデザインシステムに準拠してください:

- **カラー**:
  - メインカラー: `#00214d`
  - アクセントカラー: `#d4af37`
  - 背景: `bg-neutral-50`
  - カード: `bg-white` + `shadow-lg` + `border border-neutral-200`

- **テーブルスタイル**:
  - ヘッダー: `bg-neutral-100` + `font-bold`
  - 行: `border-b border-neutral-200`
  - ホバー効果: `hover:bg-neutral-50`

- **ボタンスタイル**:
  - 既存の62-97行目のボタンスタイルを参考にする
  - プライマリボタン: `bg-[#00214d] text-white hover:bg-[#00337a]`

---

## ⚠️ 重要な注意事項

### 実装前に質問すべき事項

以下の点について、実装前に必ず確認してください:

1. **エラーハンドリング**
   - API呼び出しが失敗した場合、どのようなエラーメッセージを表示すべきか？
   - ネットワークエラー、認証エラー、サーバーエラーで表示を分けるべきか？

2. **販路の未選択状態**
   - プルダウンで「未設定」や「選択してください」のような初期状態を用意すべきか？
   - その場合、保存時にバリデーションは必要か？

3. **保存の挙動**
   - 全ての行を一括で保存するか、変更があった行のみ保存するか？
   - 保存失敗時のリトライ処理は必要か？

4. **リアルタイム更新**
   - 保存後、自動的にマッピング一覧を再取得すべきか？
   - それとも手動リロードを促すべきか？

### 実装時の制約

- **既存コードの変更範囲**: 110-114行目のみを置き換える（他の部分は変更しない）
- **新規ファイル作成**: 不可（既存ファイルの修正のみ）
- **外部ライブラリ追加**: 不可（既存の依存関係のみ使用）

---

## 📝 実装手順の提案

1. **既存ファイルの確認**
   - 現在の`page.tsx`の全体構造を把握
   - 既存のスタイルパターンを確認

2. **質問の整理**
   - 上記「実装前に質問すべき事項」を確認し、不明点をリストアップ

3. **実装計画の提示**
   - 実装する前に、コンポーネント構造と状態管理の設計を提示
   - ユーザーの承認を得てから実装開始

4. **段階的実装**
   - Step 1: データ取得とテーブル表示
   - Step 2: プルダウン選択機能
   - Step 3: 保存機能
   - 各ステップごとに動作確認

---

## 🚀 開始方法

まず、以下を実行してください:

1. 必須参照資料（詳細設計書、既存実装）を確認
2. 「実装前に質問すべき事項」について、ユーザーに質問を返す
3. 回答を得た後、実装計画を提示
4. 承認を得てから実装開始

**重要**: 勝手に判断せず、不明点は必ず質問してください。
