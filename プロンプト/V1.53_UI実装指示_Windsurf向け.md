# V1.53 UI実装指示（Windsurf向け）

あなたはフロントエンド開発のスペシャリストとして、Rinori売上管理システムのV1.53における「広告費予算管理機能」のUI実装を担当してください。
論理層（DBスキーマおよびAPI）の実装は既にアンチグラビティによって完了しています。

## 1. 目的
- 広告費予算の設定・管理画面の実装
- 広告費入力画面への予算サマリー表示
- PL分析画面（月次・期間）への予実比較項目の追加

## 2. 参照ファイル（重要）
実装にあたっては、以下のファイルを必ず参照してください。

### 仕様・設計
- [V1.53_要件定義書_差分.md](file:///C:/Users/takuy/Desktop/売上管理システム/要件定義書/V1.53_要件定義書_差分.md)
- [V1.53_詳細設計書_差分.md](file:///C:/Users/takuy/Desktop/売上管理システム/詳細設計書/V1.53_詳細設計書_差分.md)

### 論理層・データ構造
- [prisma/schema.prisma](file:///C:/Users/takuy/Desktop/売上管理システム/rinori-sales-system/prisma/schema.prisma) (`AdBudget`モデル)
- [src/app/api/ad-budgets/route.ts](file:///C:/Users/takuy/Desktop/売上管理システム/rinori-sales-system/src/app/api/ad-budgets/route.ts) (予算CRUD)
- [src/app/api/pl/route.ts](file:///C:/Users/takuy/Desktop/売上管理システム/rinori-sales-system/src/app/api/pl/route.ts) (予実データ取得)
- [src/app/api/pl/monthly/route.ts](file:///C:/Users/takuy/Desktop/売上管理システム/rinori-sales-system/src/app/api/pl/monthly/route.ts) (月次予実データ取得)

## 3. 実装詳細

### A. 広告費管理画面の拡張
**対象ファイル**: `src/app/ad-expenses/page.tsx`

1.  **タブの追加**:
    - 既存の「広告リスト」「カテゴリ管理」に加え、「予算設定」タブを追加してください。
2.  **予算設定タブの内容 (マスター権限のみ)**:
    - 月選択（`DateNavigator`コンポーネントを使用）
    - カテゴリごとの予算額入力フィールド（数値入力）
    - 一括保存ボタン（`/api/ad-budgets`へのPOST）
3.  **広告リストタブへのサマリーパネル追加**:
    - 画面上部またはサイドバーに、選択月の「予算合計」「実績合計」「予算残高（予算 - 実績）」を表示するカードを追加してください。
    - スタッフ権限でも閲覧可能です。

### B. PL分析画面（期間PL）の更新
**対象ファイル**: `src/app/pl/page.tsx`

1.  **表示項目の追加**:
    - 「広告費」の行の下に、「広告予算」「差異」「達成率」を表示。
    - 「営業利益」の下に、「営業利益予算」「差異」「達成率」を表示。
    - 「粗利」の下に、「粗利予算」「差異」「達成率」を表示。
2.  **販路フィルタ時の制御**:
    - `salesChannelId` が選択されている場合、広告関連の予実項目は APIから `null` が返るため、画面上でも「-」または非表示としてください。

### C. 月次PL分析画面の更新
**対象ファイル**: `src/app/pl/monthly/page.tsx`

1.  **予実項目の追加**:
    - 期間PLと同様に、粗利・広告費・営業利益の各セクションに予算・差異・達成率の項目を追加し、リッチなデザイン（Tailwind CSS）でカード形式またはリスト形式で表示してください。

## 4. 技術的制約・注意点
- **デザイン**: 既存の `index.css` および Tailwind CSS のクラス（`bg-primary`, `text-primary` 等）を使用し、プレミアムな外観を維持してください。
- **権限管理**: 予算の「編集」は `session.user.role === 'master'` の場合のみ許可してください。
- **エラーハンドリング**: APIリクエスト失敗時のトースト表示や不備のある入力値へのバリデーションを適切に行ってください。

---
準備ができたら、各ファイルの修正および動作確認を開始してください。
