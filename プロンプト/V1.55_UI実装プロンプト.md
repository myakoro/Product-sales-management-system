# V1.55 UI実装依頼（Windsurf用プロンプト）

## 目的
Rinori 売上管理システム V1.55 のUI実装をお願いします。
バックエンドの論理実装（DBスキーマ、API、マイグレーション）は既に完了しています。

## 関連資料
実装にあたって、以下のドキュメントを必ず参照してください。
- **要件定義**: `C:\Users\takuy\Desktop\売上管理システム\要件定義書\V1.55_要件定義書_差分.md`
- **詳細設計**: `C:\Users\takuy\Desktop\売上管理システム\詳細設計書\V1.55_詳細設計_差分.md`

## 実装対象
以下の2つの画面の実装・更新をお願いします。

### 1. カテゴリー管理画面 (`/settings/categories`) [新規]
カテゴリーの作成・編集・削除、および商品の一括紐付けを行う画面です。
- 左側にカテゴリー一覧を表示し、選択したカテゴリーの所属商品を右側に表示してください。
- 未所属商品の一覧を下部（または右側）に表示し、チェックボックスで複数選択して「追加」ボタンで一括登録できるようにしてください。
- 商品コード（`productCode`）を識別子として使用してください。

### 2. PL分析画面の拡張 (`/pl`) [既存修正]
- 「カテゴリー別PL」タブを新規追加してください。
- カテゴリー別の売上高、売上原価、粗利、粗利率を一覧表示してください。
- 各カラムヘッダーをクリックすることで、売上高・粗利・粗利率でのソート（昇順/降順）を可能にしてください。
- 画面表示時の期間デフォルト値を「先月（前月）」に設定してください（`dayjs().subtract(1, 'month').format('YYYY-MM')`）。

## 論理実装（API）詳細
以下のAPIが実装済みです。これらを使用してUIを構築してください。

| メソッド | エンドポイント | 説明 |
| :--- | :--- | :--- |
| GET | `/api/categories` | カテゴリー一覧を取得。管理画面では `?includeInactive=true` を推奨。レスポンスは `displayOrder` 順。フィールド名は `name` です。 |
| POST | `/api/categories` | `{ name: string, displayOrder: number, isActive: boolean }` で新規作成。 |
| PUT | `/api/categories/[id]` | カテゴリー情報を更新。 |
| DELETE| `/api/categories/[id]` | カテゴリーを削除。所属商品は自動的に「未分類」に移行されます。 |
| POST | `/api/categories/[id]/products` | `{ productIds: string[] }`（商品コードの配列）で商品を一括紐付け。 |
| DELETE| `/api/categories/[id]/products` | `{ productIds: string[] }`（商品コードの配列）で紐付け解除。 |
| GET | `/api/products` | 商品一覧を取得。 `?categoryId=[id]` (所属商品) または `?categoryId=null` (未所属) でフィルタ可能。 |
| GET | `/api/pl/category` | `?targetYm=YYYY-MM&sortBy=[sales\|grossProfit\|grossProfitRate]&sortOrder=[asc\|desc]` でPLデータを取得。 |

## 実装にあたっての指示
- **無断な仕様変更禁止**: 詳細設計書に記載されているUIレイアウト、ボタン配置、挙動を遵守してください。
- **データ型の遵守**: 商品の識別子は `productCode` (String) です。APIとの通信では正確なフィールド名を使用してください。
- **デザイン**: 既存のシステムのデザイン（Tailwind CSSを使用したモダンでプレミアムなデザイン、暗色ベースの配色）に合わせ、ユーザーが驚くような美しいUIに仕上げてください。
- **確認**: 仕様が不明確な点、または実装中に疑問が生じた場合は、独断で進めずに必ずユーザーに質問してください。
- **動作確認**: APIとの疎通を確認しながら実装を進めてください。

## 進め方
1. `src/app/settings/categories/page.tsx` の作成
2. `src/app/pl/page.tsx`（または関連コンポーネント）のタブ追加とロジック修正
3. 各画面でのAPI連携と状態管理の実装
