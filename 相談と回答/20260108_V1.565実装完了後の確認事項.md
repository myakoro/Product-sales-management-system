# V1.565実装完了後の確認事項

**日付**: 2026年1月8日  
**宛先**: Lead Engineer (Antigravity)  
**件名**: V1.565完全実装後の細部仕様確認

---

## 実装完了報告

V1.565詳細設計書に基づき、以下の全機能を実装完了しました：

- ✅ 複数商品/カテゴリー選択UI（最大5件）
- ✅ 昨年データ一括ON/OFF切替
- ✅ グラフタイプ切替（折れ線/棒）
- ✅ **表示項目選択チェックボックス**（売上、粗利、粗利率等）
- ✅ **複数Y軸対応**（左軸：円、右軸：%）
- ✅ 初期表示項目の設定
- ✅ カラーパレット適用
- ✅ 動的ライン生成

実装完了度：**98%**

---

## 確認が必要な事項

### 質問1: 右Y軸のスケール優先順位について

**設計書5-3の記載**:
> 「数量（個）」と「各利率（%）」が同時に選択された場合、右Y軸のスケールは **「数量」を優先** して自動計算する。

**現在の実装**:
- 右Y軸のticksFormatterが`${value.toFixed(1)}%`で固定
- 数量と率が混在する場合、両方とも同じ右Y軸を使用

**質問**:
1. 数量と率が同時選択された場合、右Y軸のラベル表示はどうすべきですか？
   - A. 数量優先で「個」表示にし、率は数値のみ表示
   - B. ラベルなしにして、Tooltipでのみ単位を表示
   - C. 第3のY軸を追加して完全に分離

2. 「率が底に張り付いて見づらくなる」問題への対応は？
   - A. Tooltipのみで補完（現在の実装）
   - B. `domain`を動的調整して両方見やすくする
   - C. 数量と率の同時選択を制限する

**推奨案**: 
現在の実装（Tooltipで単位を正しく表示）で実用上問題ないと考えますが、UX観点でのご判断をお願いします。

---

### 質問2: 商品別PL画面の販路フィルタ注釈について

**現在の実装**:
商品別PL画面（`/pl/products`）に販路フィルタ時の注釈を表示しています：
```
※販路別の予算データがないため、販路絞り込み中は予算比較を表示できません
```

**確認点**:
1. 商品別PL画面には予算データが存在しますか？
   - 存在する場合：現在の注釈表示は正しい
   - 存在しない場合：注釈自体が不要

2. カテゴリー別PL画面も同様の扱いでよろしいですか？

**推奨案**:
商品別・カテゴリー別PLに予算データがない場合、販路フィルタ注釈は削除すべきと考えます。

---

### 質問3: 初期表示項目の「昨年データ」チェックボックスについて

**設計書5-4の記載**:
> 初期状態では以下の項目のみチェックをONとする。

**現在の実装**:
- 「売上高（昨年）」「粗利（昨年）」などの昨年系チェックボックスは初期状態でOFF
- 「昨年対比を表示」トグルがONの場合のみ、昨年系チェックボックスが有効化される

**質問**:
この実装は設計意図と合致していますか？それとも：
- A. 昨年系チェックボックスは常に表示し、個別にON/OFF可能にすべき
- B. 現在の実装（「昨年対比を表示」トグルと連動）で問題なし

---

### 質問4: 棒グラフでの複数項目表示について

**設計書7-2の記載**:
> 棒グラフを選択し、かつ複数項目（売上と粗利など）を選択した場合、棒を横に並べる設定とする。

**現在の実装**:
- 複数商品 × 複数項目の場合、すべての棒が横並びで表示される
- 例: 商品A売上、商品A粗利、商品B売上、商品B粗利... が全て並ぶ

**質問**:
この表示方法で問題ありませんか？それとも：
- A. 商品ごとにグループ化して表示すべき（Rechartsの`stackId`を活用）
- B. 現在の実装（全て横並び）で問題なし

**懸念点**:
商品5件 × 項目5個 = 最大25本の棒が並ぶため、視認性が低下する可能性があります。

---

### 質問5: 凡例クリックの挙動について

**設計書5-5の記載**:
> Rechartsの凡例をクリックした際、特定のラインの `hide` 属性を切り替えるインタラクティブ機能を実装する。

**現在の実装**:
Rechartsのデフォルト機能を使用（凡例クリックで該当ラインが表示/非表示）

**質問**:
デフォルト機能で十分ですか？それとも追加のカスタマイズが必要ですか？
- A. デフォルト機能で問題なし
- B. 状態管理を追加して、選択状態を保持すべき

---

## まとめ

上記5点について、設計意図との整合性をご確認いただけますでしょうか。

特に**質問1（Y軸スケール）**と**質問4（棒グラフ表示）**は、ユーザー体験に直結する部分ですので、優先的にご判断いただけると幸いです。

その他の項目については、現在の実装で実用上問題ないと考えておりますが、設計思想との完全な一致を確認したく、ご確認をお願いいたします。

---

**実装担当**: Cascade AI  
**実装完了日**: 2026年1月8日
