# 回答者への追加質問

## コード確認結果

ご指摘いただいた箇所を確認しました。以下の通りです：

### ✅ Route Handler (src/app/api/sales/import/route.ts:70)
```typescript
export async function POST(request: Request) {
    const formData = await request.formData(); // ← 正しく formData() を使用
    const file = formData.get('file') as File;
    // ...
}
```

### ✅ フロント側送信 (src/app/import/sales/page.tsx:101-104)
```typescript
const res = await fetch("/api/import/sales", {
    method: "POST",
    body: formData, // ← FormDataを使用、Content-Typeは手動指定していない
});
```

### ❓ フロント側受信 (src/app/import/sales/page.tsx:106)
```typescript
const data = await res.json(); // ← サーバーはJSONを返すはず
```

## 問題点

ご指摘の通り、`request.json()`と`request.formData()`の使い分けは正しいのですが、**まだ同じエラーが発生しています**。

エラースタックトレース：
```
at parseJSONFromBytes (node:internal/deps/undici/undici:6433:19)
at successSteps (node:internal/deps/undici/undici:6414:27)
```

これは、undiciが**リクエスト受信時**にJSONパースを試みていることを示しています。

## 質問

1. **Route Handler内で、他に`request.json()`を呼んでいる箇所がある可能性はありますか？**
   - 例：ミドルウェア、Next.jsの内部処理、共通ラッパーなど

2. **CSVファイルの内容自体が問題になっている可能性はありますか？**
   - 例：ファイルの先頭が `-` で始まる場合、何らかの処理でJSONと誤認される？

3. **Next.js 14.2.18で、FormData処理に既知の問題はありますか？**

4. **`file.arrayBuffer()`（route.ts:97）の前段階で、何か問題が起きている可能性はありますか？**

現在のコードは、ご指摘いただいた内容に完全に準拠しているように見えますが、エラーが継続しています。

追加のアドバイスをいただけますでしょうか？
